<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>COSTAATT| COSTAATT Bursar Department</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
<style>:root{--primary-color:#6a0dad;--secondary-color:#ff7043;--accent-color:#ff9800;--light-bg:#f9f9f9;--dark-bg:#1a1a2e;--dark-card:#16213e;--dark-text:#e6e6e6;--light-text:#333;--shadow:0 5px 15px rgba(0,0,0,0.1);--transition:all 0.3s ease}.dark-mode{--light-bg:var(--dark-bg);--light-text:var(--dark-text)}*{margin:0;padding:0;box-sizing:border-box;transition:var(--transition)}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:var(--light-bg);color:var(--light-text);line-height:1.6;padding:20px;transition:var(--transition)}.container{max-width:1200px;margin:0 auto}header{text-align:center;margin-bottom:30px;padding:20px;border-radius:15px;background:linear-gradient(135deg,var(--primary-color),#8a2be2);color:#fff;box-shadow:var(--shadow);position:relative;overflow:hidden}header::before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgb(255 255 255 / .1) 0%,#fff0 70%);z-index:0}header h1{font-size:2.5rem;margin-bottom:10px;position:relative;z-index:1}header p{font-size:1.2rem;opacity:.9;position:relative;z-index:1}.theme-toggle{position:absolute;top:20px;right:20px;background:rgb(255 255 255 / .2);border:none;border-radius:50%;width:50px;height:50px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.5rem;color:#fff;z-index:1;transition:var(--transition)}.theme-toggle:hover{transform:rotate(30deg);background:rgb(255 255 255 / .3)}.calculator-card{background-color:#fff;border-radius:15px;box-shadow:var(--shadow);padding:25px;margin-bottom:25px;transition:var(--transition)}.dark-mode .calculator-card{background-color:var(--dark-card)}h2,h3{color:var(--primary-color);margin-bottom:20px;display:flex;align-items:center}.dark-mode h2,.dark-mode h3{color:var(--secondary-color)}h2::before,h3::before{margin-right:10px;font-size:1.5em}h2::before{content:"üìä"}h3::before{content:"üí∞"}.controls{display:flex;gap:15px;margin-bottom:20px;flex-wrap:wrap}button{padding:12px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:700;transition:var(--transition);display:flex;align-items:center;gap:8px}.btn-primary{background-color:var(--primary-color);color:#fff}.btn-primary:hover{background-color:#5a0b9d;transform:translateY(-2px);box-shadow:0 4px 8px rgb(0 0 0 / .15)}.btn-secondary{background-color:var(--secondary-color);color:#fff}.btn-secondary:hover{background-color:#e65c3e;transform:translateY(-2px);box-shadow:0 4px 8px rgb(0 0 0 / .15)}.btn-accent{background-color:var(--accent-color);color:#fff}.btn-accent:hover{background-color:#e68900;transform:translateY(-2px);box-shadow:0 4px 8px rgb(0 0 0 / .15)}button:disabled{background-color:#ccc;cursor:not-allowed;transform:none;box-shadow:none}table{width:100%;border-collapse:collapse;background-color:#fff;box-shadow:0 0 10px rgb(0 0 0 / .05);border-radius:10px;overflow:hidden;margin-bottom:20px}.dark-mode table{background-color:var(--dark-card)}th,td{padding:15px;text-align:center;border-bottom:1px solid #e0e0e0}.dark-mode th,.dark-mode td{border-bottom:1px solid #2d3746}th{background-color:var(--primary-color);color:#fff;font-weight:600;text-transform:uppercase;font-size:14px}tr:nth-child(even){background-color:#f8f4ff}.dark-mode tr:nth-child(even){background-color:#1f2a40}tr:hover{background-color:#f0e5ff}.dark-mode tr:hover{background-color:#2a3650}input,select{padding:10px;border-radius:6px;border:1px solid #ddd;transition:var(--transition);width:100%}.dark-mode input,.dark-mode select{background-color:#2d3746;border-color:#3a4558;color:var(--dark-text)}input:focus,select:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 5px rgb(106 13 173 / .3)}.total-display{font-weight:700;color:var(--primary-color);font-size:18px}.dark-mode .total-display{color:var(--secondary-color)}.fee-calculator{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:20px}.fee-item{display:flex;flex-direction:column}.fee-item label{font-weight:700;margin-bottom:8px;color:var(--primary-color)}.dark-mode .fee-item label{color:var(--secondary-color)}.fee-input{position:relative}.fee-input::before{content:"$";position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#666}.fee-input input{padding-left:25px}.totals-section{background-color:#f3e5f5;padding:20px;border-radius:10px;margin-top:20px;box-shadow:0 2px 5px rgb(0 0 0 / .1)}.dark-mode .totals-section{background-color:#2a1b3d}.totals-section div{display:flex;justify-content:space-between;margin-bottom:10px}.grand-total{font-size:24px;font-weight:700;border-top:2px solid var(--primary-color);padding-top:15px;margin-top:15px}.dark-mode .grand-total{border-top-color:var(--secondary-color)}.disclaimer{background-color:#fff8e6;border-left:5px solid #ffa726;padding:20px;margin-top:30px;border-radius:0 10px 10px 0;box-shadow:0 2px 5px rgb(0 0 0 / .05)}.dark-mode .disclaimer{background-color:#332b1a;border-left-color:#e68900}.disclaimer h3{margin-top:0;color:#e65100;border-bottom:1px solid #e0c800;padding-bottom:10px}.dark-mode .disclaimer h3{color:#ffa726}.disclaimer p{margin-bottom:15px}.disclaimer ol{margin:15px 0;padding-left:20px}.disclaimer li{margin-bottom:10px}.course-type-tabs{display:flex;margin-bottom:20px;border-bottom:2px solid #e0e0e0}.dark-mode .course-type-tabs{border-bottom-color:#3a4558}.course-type-tab{padding:12px 24px;cursor:pointer;background-color:#f1f1f1;border:1px solid #ddd;border-bottom:none;margin-right:5px;border-radius:8px 8px 0 0;transition:var(--transition)}.dark-mode .course-type-tab{background-color:#2d3746;border-color:#3a4558;color:var(--dark-text)}.course-type-tab.active{background-color:var(--primary-color);color:#fff;border-color:var(--primary-color)}.dark-mode .course-type-tab.active{background-color:var(--secondary-color);border-color:var(--secondary-color)}.short-courses-section{display:none}.instructions{background-color:#ede7f6;border-left:5px solid var(--primary-color);padding:20px;margin-bottom:30px;border-radius:0 10px 10px 0;display:none}.dark-mode .instructions{background-color:#2a1b3d;border-left-color:var(--secondary-color)}.instructions.show{display:block}@media (max-width:768px){.fee-calculator{grid-template-columns:1fr}.course-type-tabs{flex-direction:column}.course-type-tab{border-radius:8px;margin-bottom:5px}header h1{font-size:2rem}}
.student-info-section {
  margin-bottom: 25px;
  padding: 20px;
  background-color: #f8f4ff;
  border-radius: 10px;
}

.dark-mode .student-info-section {
  background-color: #2a1b3d;
}

.agreement-content {
  margin-top: 20px;
}

.terms-box {
  background-color: #fff;
  border: 2px solid var(--primary-color);
  border-radius: 10px;
  padding: 25px;
  margin-bottom: 25px;
  max-height: 400px;
  overflow-y: auto;
}

.dark-mode .terms-box {
  background-color: var(--dark-card);
  border-color: var(--secondary-color);
}

.terms-box h4 {
  color: var(--primary-color);
  margin-bottom: 15px;
  text-align: center;
}

.dark-mode .terms-box h4 {
  color: var(--secondary-color);
}

.terms-box ol {
  margin: 15px 0;
  padding-left: 20px;
}

.terms-box li {
  margin-bottom: 12px;
  line-height: 1.5;
}

.signature-section {
  margin: 25px 0;
}

.signature-pad-container {
  border: 2px dashed #ddd;
  border-radius: 8px;
  padding: 15px;
  background-color: #fff;
  margin-top: 10px;
}

.dark-mode .signature-pad-container {
  background-color: var(--dark-card);
  border-color: #3a4558;
}

#signaturePad {
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: crosshair;
}

.agreement-controls {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  margin-top: 25px;
}

@media (max-width: 768px) {
  .agreement-controls {
    flex-direction: column;
  }
  
  #signaturePad {
    width: 100%;
    height: 120px;
  }
}

</style>
</head>
<body>
  <div class="container">
    <header>
      <button class="theme-toggle" id="themeToggle">üåô</button>
      <h1>COSTAATT</h1>
      <p>Student Calculator by COSTAATT Bursar Department</p>
    </header>

    <button class="btn-accent" onclick="toggleInstructions()" style="margin-bottom: 20px;">
      <span>üìù</span> Show Instructions
    </button>

<div class="instructions" id="instructions">
  <strong style="font-size: 16px;">üìù Instructions:</strong><br><br>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">1.</span>
    <span><span class="highlight">Please use the fee calculator‚Äîwhich accounts for</span>tuition, college, and other applicable fees‚Äîto calculate your next payment to COSTAATT.</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">2.</span>
    <span><span class="highlight">GATE Programme</span>provides financial assistance to citizens of Trinidad and Tobago,<span class="highlight">who are pursuing GATE-approved tertiary level programmes at COSTAATT.</span></span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">3.</span>
    <span><span class="highlight">COMPASS Courses</span>are<span class="highlight">only GATE-funded</span> if you're registered in the COMPASS Programme.</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">4.</span>
    <span><span class="highlight">Please note that GATE does not cover</span> the cost of withdrawn and repeated courses. These are self-funded courses that must be paid by the Academic Calendar Deadline.</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">5.</span>
    <span>If you are a <span class="highlight">Postgraduate student</span>,select the<span class="highlight">Postgraduate</span> tab to calculate your next fee payment.</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">6.</span>
    <span>Click <span class="highlight">Add Row</span> to include more courses (up to a maximum of <span class="highlight">8 rows</span>).</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">7.</span>
    <span>Click <span class="highlight">Reset Table</span> to clear your entries and start over.</span>
  </div>
</div>

<style>
.highlight {
  background-color: #ede7f6;
  font-weight: bold;
  padding: 2px 5px;
}
</style>


    <div class="course-type-tabs">
      <div class="course-type-tab active" id="undergradTab" onclick="switchCourseType('undergrad')">Undergraduate Courses</div>
      <div class="course-type-tab" id="gradTab" onclick="switchCourseType('grad')">Postgraduate Courses</div>
      <div class="course-type-tab" id="agreementTab" onclick="switchCourseType('agreement')">Payment Terms Agreement</div>
    </div>

    <div class="calculator-card">
      <h3>Student Fee Calculator (Late Fee Applies from 1st October, 2025)</h3>
      
      <div class="controls">
        <button class="btn-primary" id="addRowBtn">
          <span>‚ûï</span> Add Row
        </button>
        <button class="btn-secondary" id="resetTableBtn">
          <span>üîÑ</span> Reset Table
        </button>
      </div>

      <table id="tuitionTable">
        <thead>
          <tr>
            <th>Student Type</th>
            <th>Credits</th>
            <th>Course Description</th>
            <th>Course Type</th>
            <th>Tuition Fee</th>
            <th>GATE</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot>
          <tr>
            <td colspan="6"><strong>Tuition Fees Total</strong></td>
            <td><span id="tuitionGrandTotal" class="total-display">$0.00</span></td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

   <div class="calculator-card">
      <h3>College Fees Calculator</h3>
      
      <div class="fee-calculator">
        <div class="fee-item">
          <label for="registrationFee">College Fees:</label>
          <select id="registrationFee">
            <option value="0">$0</option>
            <option value="280">$280</option>
            <option value="410">$410</option>
          </select>
        </div>
        
        <div class="fee-item">
          <label for="lateFee">Late Fee:</label>
          <select id="lateFee">
            <option value="0">$0</option>
            <option value="50">$50</option>
          </select>
        </div>
      </div>
      
      <div class="controls">
        <button class="btn-accent" onclick="resetCollegeFees()">
          <span>üîÑ</span> Reset College Fees
        </button>
      </div>
    </div>

    <div class="calculator-card">
      <h3>Other Fees</h3>
      
      <div class="fee-calculator">
        <div class="fee-item">
          <label for="otherFees">Other Fees:</label>
          <div class="fee-input">
            <input type="number" id="otherFees" min="0" value="0">
          </div>
        </div>
      </div>
      
      <div class="controls">
        <button class="btn-accent" onclick="resetOtherFees()">
          <span>üîÑ</span> Reset Other Fees
        </button>
      </div>
    </div>

<!-- Add this after the "Other Fees" calculator card -->
<div class="calculator-card" id="agreementSection" style="display: none;">
  <h3>Payment Terms Agreement and Conditions</h3>
  
  <div class="student-info-section">
    <div class="fee-calculator">
      <div class="fee-item">
        <label for="studentName">Full Name:</label>
        <input type="text" id="studentName" placeholder="Enter your full name">
      </div>
      <div class="fee-item">
        <label for="studentId">Student ID Number:</label>
        <input type="text" id="studentId" placeholder="Enter your student ID">
      </div>
      <div class="fee-item">
        <label for="agreementDate">Date:</label>
        <input type="date" id="agreementDate">
      </div>
    </div>
  </div>

  <div class="agreement-content">
    <div class="terms-box">
      <h4>COSTAATT Payment Terms and Conditions</h4>
      <p><strong>Effective Date: October 1, 2025</strong></p>
      
      <ol>
        <li><strong>Payment Obligation:</strong> I understand that I am responsible for paying all tuition and fees by the published deadlines.</li>
        <li><strong>Late Fees:</strong> A late fee of $50 will be applied to all payments received after the official deadline.</li>
        <li><strong>GATE Funding:</strong> I understand that GATE funding is subject to approval and may not cover all courses.</li>
        <li><strong>Withdrawal Policy:</strong> Withdrawn and repeated courses are not covered by GATE and must be self-funded.</li>
        <li><strong>Financial Hold:</strong> Failure to pay fees may result in a financial hold preventing registration and access to academic records.</li>
        <li><strong>Payment Plan:</strong> Payment plans may be available upon request and require separate approval.</li>
        <li><strong>Accuracy:</strong> I verify that the information provided in the fee calculator is accurate to the best of my knowledge.</li>
      </ol>
      
      <p><strong>Declaration:</strong> By signing this agreement, I acknowledge that I have read, understood, and agree to abide by the above terms and conditions.</p>
    </div>

    <div class="signature-section">
      <label for="signature">Electronic Signature:</label>
      <div class="signature-pad-container">
        <canvas id="signaturePad" width="400" height="150"></canvas>
        <button type="button" class="btn-secondary" onclick="clearSignature()" style="margin-top: 10px;">
          <span>üóëÔ∏è</span> Clear Signature
        </button>
      </div>
    </div>

    <div class="agreement-controls">
      <button class="btn-primary" onclick="generateAgreementPDF()">
        <span>üìÑ</span> Download Signed Agreement (PDF)
      </button>
      <button class="btn-secondary" onclick="downloadBlankAgreement()">
        <span>üìù</span> Download Blank Agreement
      </button>
      <button class="btn-accent" onclick="resetAgreement()">
        <span>üîÑ</span> Reset Form
      </button>
    </div>
  </div>
</div>

    <div class="calculator-card">
      <div class="totals-section">
        <div>
          <span>Tuition Fees Total:</span>
          <span id="displayTuitionTotal" class="total-display">$0.00</span>
        </div>
        <div>
          <span>College Fees Total:</span>
          <span id="displayCollegeFeesTotal" class="total-display">$0.00</span>
        </div>
        <div>
          <span>Other Fees Total:</span>
          <span id="displayOtherFeesTotal" class="total-display">$0.00</span>
        </div>
        <div class="grand-total">
          <span>Grand Total:</span>
          <span id="grandTotal" class="total-display">$0.00</span>
        </div>
      </div>
    </div>

   <div class="disclaimer">
  <h3>Legal Disclaimer</h3>
  <p>The calculations generated by this tool are <strong>estimates only</strong> and are based on the fee information you, the student, have entered from your Account Summary.</p>
  <p>This Student Fee Calculator is provided<strong> for guidance purposes </strong>only and is intended to help you estimate the self-funded portion of your next payment.</strong>The calculated amounts are estimates and may not reflect your final balance.</p> 
  
  <p>Additional Information:</p>
  <ol>
    <li>A late fee will apply if payment is made after the College's official fee deadline (see the Academic Calendar).</li>
    <li>All amounts are quoted in Trinidad and Tobago Dollars (TTD) unless otherwise stated.</li>
    <li>GATE funding: Confirmed rates are determined by the Ministry of Education Funding and Grant Division and are subject to their review and approval.</li>
    <li>Final tuition and fees must <strong>be confirmed with the College's Bursar Department.</strong></li>
  </ol>
  
  <p style="font-weight:bold; border-top:1px solid #ccc; padding-top:10px;">
  This tool does not constitute professional financial advice under the Financial Institutions Act, Chap. 79:09 of Trinidad and Tobago.
  </p>
    </div>
  </div>

  <script>
     
    const studentTypes = ['Local National', 'Caricom National', 'International National'];
    const courseOptions = ['Compass Course', 'Undergraduate Course', 'Repeated Course'];
    const gradCourseOptions = ['Compass Course', 'Graduate Course', 'Repeated Course'];
      const gateOptions = ['0%', '50%', '75%', '100%'];
    const creditOptions = [1, 2, 3, 4];
    
    // Tuition fees for undergraduate, graduate and short courses
    let tuitionFees = {
      'undergrad': {
        'Local National': 300,
        'Caricom National': 450,
        'International National': 750
      },
      'grad': {
        'Local National': 500,
        'Caricom National': 600,
        'International National': 750
      }
    };
    
    const maxRows = 8;
    let currentRowCount = 0;
    let lastSelectedType = 'Local National';
    let lastSelectedGate = '0%';
    let currentCourseType = 'undergrad'; // 'undergrad', 'grad', or 'short'

function switchCourseType(type) {
  currentCourseType = type;
  document.getElementById('undergradTab').classList.remove('active');
  document.getElementById('gradTab').classList.remove('active');
  document.getElementById(type + 'Tab').classList.add('active');
  
  // Update all rows with new course options and tuition fees
  for (let i = 0; i < currentRowCount; i++) {
    updateCourseOptions(i);
    updateRow(i);
  }
  
  // Update totals
  updateTotalsSection();
}

function updateCourseOptions(index) {
  const row = document.getElementById('tableBody').rows[index];
  if (!row) return;

  const courseSelect = row.cells[3].querySelector('select');
  const currentValue = courseSelect.value;
  
  // Clear existing options
  courseSelect.innerHTML = '';
  
  // Add new options based on current course type
  const allowedCourseTypes = currentCourseType === 'undergrad' ? 
    ['Compass Course','Undergraduate Course', 'Repeated Course'] : 
    ['Postgraduate Course', 'Repeated Course'];
  
  allowedCourseTypes.forEach(course => {
    const option = document.createElement('option');
    option.value = course;
    option.text = course;
    
    // Try to preserve the equivalent selection when switching
    if ((currentValue === 'Undergraduate Course' && course === 'Graduate Course') ||
        (currentValue === 'Graduate Course' && course === 'Undergraduate Course') ||
        currentValue === course) {
      option.selected = true;
    }
    
    courseSelect.appendChild(option);
  });
}

    function createRow(index) {
      if (currentRowCount >= maxRows) return;

      const row = document.createElement('tr');
      row.dataset.index = index;

      // Student Type
      const studentCell = document.createElement('td');
      const studentSelect = document.createElement('select');
      studentTypes.forEach(type => {
        const option = document.createElement('option');
        option.value = type;
        option.text = type;
        if (type === lastSelectedType) option.selected = true;
        studentSelect.appendChild(option);
      });
      studentSelect.addEventListener('change', () => {
        lastSelectedType = studentSelect.value;
        updateRow(index);
      });
      studentCell.appendChild(studentSelect);
      row.appendChild(studentCell);

      // Credits Selector
      const creditCell = document.createElement('td');
      const creditSelect = document.createElement('select');
      creditOptions.forEach(credit => {
        const option = document.createElement('option');
        option.value = credit;
        option.text = credit;
        creditSelect.appendChild(option);
      });
      creditSelect.addEventListener('change', () => {
        updateRow(index);
      });
      creditCell.appendChild(creditSelect);
      row.appendChild(creditCell);

      // Course Description (based on credits)
      const courseDescCell = document.createElement('td');
      const courseDescSpan = document.createElement('span');
      courseDescSpan.id = `courseDesc-${index}`;
      courseDescSpan.textContent = 'Select credits';
      courseDescCell.appendChild(courseDescSpan);
      row.appendChild(courseDescCell);

      // Course Type
      const courseCell = document.createElement('td');
      const courseSelect = document.createElement('select');
      const allowedCourseTypes = currentCourseType === 'undergrad' ? 
        ['Compass Course', 'Undergraduate Course', 'Repeated Course'] : 
        ['Compass Course', 'Graduate Course', 'Repeated Course'];
      
      allowedCourseTypes.forEach(course => {
        const option = document.createElement('option');
        option.value = course;
        option.text = course;
        courseSelect.appendChild(option);
      });
      courseSelect.addEventListener('change', () => {
        updateRow(index);
      });
      courseCell.appendChild(courseSelect);
      row.appendChild(courseCell);

      // Tuition Fee
      const feeCell = document.createElement('td');
      const feeInput = document.createElement('input');
      feeInput.type = 'number';
      feeInput.readOnly = true;
      feeInput.style.backgroundColor = '#f5f5f5';
      feeInput.style.border = '1px solid #ddd';
      feeCell.appendChild(feeInput);
      row.appendChild(feeCell);

      // GATE
      const gateCell = document.createElement('td');
      const gateSelect = document.createElement('select');
      gateOptions.forEach(optionVal => {
        const option = document.createElement('option');
        option.value = optionVal;
        option.text = optionVal;
        if (optionVal === lastSelectedGate) option.selected = true;
        gateSelect.appendChild(option);
      });
      gateSelect.addEventListener('change', () => {
        lastSelectedGate = gateSelect.value;
        updateRow(index);
      });
      gateCell.appendChild(gateSelect);
      row.appendChild(gateCell);

      // Total
      const totalCell = document.createElement('td');
      const totalSpan = document.createElement('span');
      totalSpan.id = `total-${index}`;
      totalSpan.textContent = '$0.00';
      totalSpan.style.fontWeight = 'bold';
      totalCell.appendChild(totalSpan);
      row.appendChild(totalCell);

      // Clear Button
      const actionCell = document.createElement('td');
      const clearBtn = document.createElement('button');
      clearBtn.textContent = '‚ùå';
      clearBtn.style.background = 'none';
      clearBtn.style.border = 'none';
      clearBtn.style.cursor = 'pointer';
      clearBtn.style.fontSize = '18px';
      clearBtn.addEventListener('click', () => clearRow(index));
      actionCell.appendChild(clearBtn);
      row.appendChild(actionCell);

      document.getElementById('tableBody').appendChild(row);
      currentRowCount++;
      updateRow(index);

      if (currentRowCount >= maxRows) {
        document.getElementById('addRowBtn').disabled = true;
      }
    }

// Add these variables with other global variables
let signaturePad;
let isAgreementActive = false;

// Add to the switchCourseType function
function switchCourseType(type) {
  currentCourseType = type;
  document.getElementById('undergradTab').classList.remove('active');
  document.getElementById('gradTab').classList.remove('active');
  document.getElementById('agreementTab').classList.remove('active');
  document.getElementById(type + 'Tab').classList.add('active');
  
  // Hide all sections
  document.querySelectorAll('.calculator-card').forEach(card => {
    card.style.display = 'none';
  });
  
  // Show relevant section
  if (type === 'agreement') {
    document.getElementById('agreementSection').style.display = 'block';
    isAgreementActive = true;
    initializeSignaturePad();
  } else {
    document.querySelectorAll('.calculator-card').forEach(card => {
      if (card.id !== 'agreementSection') {
        card.style.display = 'block';
      }
    });
    isAgreementActive = false;
  }
  
  // Update all rows with new course options and tuition fees
  for (let i = 0; i < currentRowCount; i++) {
    updateCourseOptions(i);
    updateRow(i);
  }
  
  // Update totals
  updateTotalsSection();
}

// Add these new functions
function initializeSignaturePad() {
  const canvas = document.getElementById('signaturePad');
  if (!canvas) return;
  
  // Set current date as default
  document.getElementById('agreementDate').valueAsDate = new Date();
  
  // Initialize signature pad
  signaturePad = new SignaturePad(canvas, {
    backgroundColor: 'transparent',
    penColor: 'rgb(0, 0, 0)'
  });
  
  // Adjust canvas size for high DPI displays
  const ratio = Math.max(window.devicePixelRatio || 1, 1);
  canvas.width = canvas.offsetWidth * ratio;
  canvas.height = canvas.offsetHeight * ratio;
  canvas.getContext("2d").scale(ratio, ratio);
  signaturePad.clear();
}

function clearSignature() {
  if (signaturePad) {
    signaturePad.clear();
  }
}

function generateAgreementPDF() {
  const studentName = document.getElementById('studentName').value;
  const studentId = document.getElementById('studentId').value;
  const agreementDate = document.getElementById('agreementDate').value;
  
  if (!studentName || !studentId || !agreementDate) {
    alert('Please fill in all required fields: Name, Student ID, and Date.');
    return;
  }
  
  if (signaturePad.isEmpty()) {
    alert('Please provide your electronic signature.');
    return;
  }
  
  // In a real implementation, you would use a library like jsPDF
  // This is a simplified version that creates a downloadable HTML page
  const signatureData = signaturePad.toDataURL();
  
  const pdfContent = `
    <!DOCTYPE html>
    <html>
    <head>
      <title>COSTAATT Payment Terms Agreement</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .header { text-align: center; margin-bottom: 30px; }
        .student-info { margin-bottom: 20px; }
        .terms-box { border: 1px solid #000; padding: 20px; margin: 20px 0; }
        .signature-box { margin-top: 50px; }
        .signature-img { max-width: 300px; border-bottom: 1px solid #000; padding-bottom: 10px; }
        .footer { margin-top: 50px; font-size: 12px; color: #666; }
      </style>
    </head>
    <body>
      <div class="header">
        <h1>COSTAATT</h1>
        <h2>Payment Terms Agreement and Conditions</h2>
      </div>
      
      <div class="student-info">
        <p><strong>Student Name:</strong> ${studentName}</p>
        <p><strong>Student ID:</strong> ${studentId}</p>
        <p><strong>Date:</strong> ${new Date(agreementDate).toLocaleDateString()}</p>
      </div>
      
      <div class="terms-box">
        <h3>Payment Terms and Conditions</h3>
        <ol>
          <li><strong>Payment Obligation:</strong> I understand that I am responsible for paying all tuition and fees by the published deadlines.</li>
          <li><strong>Late Fees:</strong> A late fee of $50 will be applied to all payments received after the official deadline.</li>
          <li><strong>GATE Funding:</strong> I understand that GATE funding is subject to approval and may not cover all courses.</li>
          <li><strong>Withdrawal Policy:</strong> Withdrawn and repeated courses are not covered by GATE and must be self-funded.</li>
          <li><strong>Financial Hold:</strong> Failure to pay fees may result in a financial hold preventing registration and access to academic records.</li>
          <li><strong>Payment Plan:</strong> Payment plans may be available upon request and require separate approval.</li>
          <li><strong>Accuracy:</strong> I verify that the information provided in the fee calculator is accurate to the best of my knowledge.</li>
        </ol>
        
        <p><strong>Declaration:</strong> By signing this agreement, I acknowledge that I have read, understood, and agree to abide by the above terms and conditions.</p>
      </div>
      
      <div class="signature-box">
        <p><strong>Electronic Signature:</strong></p>
        <img src="${signatureData}" alt="Signature" class="signature-img">
        <p>${studentName}</p>
      </div>
      
      <div class="footer">
        <p>Generated on: ${new Date().toLocaleDateString()} | COSTAATT Bursar Department</p>
      </div>
    </body>
    </html>
  `;
  
  // Create and download the PDF (simplified version)
  const blob = new Blob([pdfContent], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `COSTAATT-Agreement-${studentId}-${agreementDate}.html`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  alert('Agreement downloaded successfully!');
}

function downloadBlankAgreement() {
  // Similar to generateAgreementPDF but without student data
  const pdfContent = `
    <!DOCTYPE html>
    <html>
    <head>
      <title>COSTAATT Payment Terms Agreement</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .header { text-align: center; margin-bottom: 30px; }
        .student-info { margin-bottom: 20px; border-bottom: 1px solid #000; padding-bottom: 10px; }
        .terms-box { border: 1px solid #000; padding: 20px; margin: 20px 0; }
        .signature-box { margin-top: 50px; border-bottom: 1px solid #000; padding-bottom: 10px; min-height: 100px; }
        .footer { margin-top: 50px; font-size: 12px; color: #666; }
      </style>
    </head>
    <body>
      <div class="header">
        <h1>COSTAATT</h1>
        <h2>Payment Terms Agreement and Conditions</h2>
      </div>
      
      <div class="student-info">
        <p><strong>Student Name:</strong> ________________________________</p>
        <p><strong>Student ID:</strong> ________________________________</p>
        <p><strong>Date:</strong> ________________________________</p>
      </div>
      
      <div class="terms-box">
        <h3>Payment Terms and Conditions</h3>
        <ol>
          <li><strong>Payment Obligation:</strong> I understand that I am responsible for paying all tuition and fees by the published deadlines.</li>
          <li><strong>Late Fees:</strong> A late fee of $50 will be applied to all payments received after the official deadline.</li>
          <li><strong>GATE Funding:</strong> I understand that GATE funding is subject to approval and may not cover all courses.</li>
          <li><strong>Withdrawal Policy:</strong> Withdrawn and repeated courses are not covered by GATE and must be self-funded.</li>
          <li><strong>Financial Hold:</strong> Failure to pay fees may result in a financial hold preventing registration and access to academic records.</li>
          <li><strong>Payment Plan:</strong> Payment plans may be available upon request and require separate approval.</li>
          <li><strong>Accuracy:</strong> I verify that the information provided in the fee calculator is accurate to the best of my knowledge.</li>
        </ol>
        
        <p><strong>Declaration:</strong> By signing this agreement, I acknowledge that I have read, understood, and agree to abide by the above terms and conditions.</p>
      </div>
      
      <div class="signature-box">
        <p><strong>Signature:</strong></p>
      </div>
      
      <div class="footer">
        <p>COSTAATT Bursar Department</p>
      </div>
    </body>
    </html>
  `;
  
  const blob = new Blob([pdfContent], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'COSTAATT-Blank-Agreement.html';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function resetAgreement() {
  document.getElementById('studentName').value = '';
  document.getElementById('studentId').value = '';
  document.getElementById('agreementDate').valueAsDate = new Date();
  clearSignature();
}

    function updateRow(index) {
      const row = document.getElementById('tableBody').rows[index];
      if (!row) return;

      const studentType = row.cells[0].querySelector('select').value;
      const credits = parseInt(row.cells[1].querySelector('select').value) || 0;
      const courseType = row.cells[3].querySelector('select').value;
      const feeInput = row.cells[4].querySelector('input');
      const gateSelect = row.cells[5].querySelector('select');

      // Update course description based on credits
      const courseDescSpan = document.getElementById(`courseDesc-${index}`);
      if (credits === 1) {
        courseDescSpan.textContent = 'One Credit Course';
      } else if (credits === 2) {
        courseDescSpan.textContent = 'Two Credit Course';
      } else if (credits === 3) {
        courseDescSpan.textContent = 'Three Credit Course';
      } else if (credits === 4) {
        courseDescSpan.textContent = 'Four Credit Course';
      } else if (credits === 5) {
        courseDescSpan.textContent = 'Five Credit Course';
      } else {
        courseDescSpan.textContent = 'Select credits';
      }

      // Get tuition fee based on course type (undergrad/grad) and student type
      const tuitionFee = tuitionFees[currentCourseType][studentType];
      feeInput.value = tuitionFee;

      // Disable GATE if not Local National OR if not Undergraduate Course
      const isCompassOrRepeated = courseType === 'Compass Course' || courseType === 'Repeated Course';
      const isUndergradCourse = courseType === 'Undergraduate Course';
      const isLocalNational = studentType === 'Local National';
      
      gateSelect.disabled = !isLocalNational || !isUndergradCourse || isCompassOrRepeated;
      
      // If not eligible for GATE, force to 0%
      if (!isLocalNational || !isUndergradCourse || isCompassOrRepeated) {
        gateSelect.value = '0%';
      }

      const gateVal = gateSelect.value;
      const gateMap = {
        '0%': 1,
        '25%': 0.75,
        '50%': 0.5,
        '75%': 0.25,
        '100%': 0
      };
      const gateMultiplier = (isLocalNational && isUndergradCourse && !isCompassOrRepeated) ? gateMap[gateVal] : 1;

      const total = credits * tuitionFee * gateMultiplier;
      document.getElementById(`total-${index}`).textContent = `$${total.toFixed(2)}`;

      computeTuitionGrandTotal();
      updateTotalsSection();
    }

    function computeTuitionGrandTotal() {
      let total = 0;
      for (let i = 0; i < currentRowCount; i++) {
        const totalText = document.getElementById(`total-${i}`)?.textContent || '$0';
        total += parseFloat(totalText.replace('$', '')) || 0;
      }
      document.getElementById('tuitionGrandTotal').textContent = `$${total.toFixed(2)}`;
      document.getElementById('displayTuitionTotal').textContent = `$${total.toFixed(2)}`;
      updateGrandTotal();
    }

    function updateCollegeFeesCalculator() {
      const registrationFee = parseFloat(document.getElementById('registrationFee').value) || 0;
      const lateFee = parseFloat(document.getElementById('lateFee').value) || 0;
      
      const totalCollegeFees = registrationFee + lateFee;
      
      document.getElementById('displayCollegeFeesTotal').textContent = `$${totalCollegeFees.toFixed(2)}`;
      updateGrandTotal();
    }

    function updateOtherFeesCalculator() {
      const otherFees = parseFloat(document.getElementById('otherFees').value) || 0;
      document.getElementById('displayOtherFeesTotal').textContent = `$${otherFees.toFixed(2)}`;
      updateGrandTotal();
    }

    function updateTotalsSection() {
      updateCollegeFeesCalculator();
      updateOtherFeesCalculator();
      updateGrandTotal();
    }

    function updateGrandTotal() {
      const tuitionTotal = parseFloat(document.getElementById('displayTuitionTotal').textContent.replace('$', '')) || 0;
      const collegeFeesTotal = parseFloat(document.getElementById('displayCollegeFeesTotal').textContent.replace('$', '')) || 0;
      const otherFeesTotal = parseFloat(document.getElementById('displayOtherFeesTotal').textContent.replace('$', '')) || 0;
      const grandTotal = tuitionTotal + collegeFeesTotal + otherFeesTotal;
      document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
    }

    function resetCollegeFees() {
      document.getElementById('registrationFee').value = '0';
      document.getElementById('lateFee').value = '0';
      updateCollegeFeesCalculator();
    }

    function resetOtherFees() {
      document.getElementById('otherFees').value = '0';
      updateOtherFeesCalculator();
    }

    function clearRow(index) {
      const row = document.getElementById('tableBody').rows[index];
      if (!row) return;

      row.cells[1].querySelector('select').value = '1';
      document.getElementById(`courseDesc-${index}`).textContent = 'One Credit Course';
      row.cells[3].querySelector('select').value = courseOptions[0];
      row.cells[4].querySelector('input').value = tuitionFees[currentCourseType][lastSelectedType];
      row.cells[5].querySelector('select').value = lastSelectedGate;
      document.getElementById(`total-${index}`).textContent = '$0.00';

      updateRow(index);
    }

    function resetTable() {
      document.getElementById('tableBody').innerHTML = '';
      document.getElementById('tuitionGrandTotal').textContent = '$0.00';
      document.getElementById('displayTuitionTotal').textContent = '$0.00';
      currentRowCount = 0;
      document.getElementById('addRowBtn').disabled = false;
      createRow(0);
      updateTotalsSection();
    }

    function toggleInstructions() {
      const instructions = document.getElementById('instructions');
      const button = event.target.closest('button');
      const isVisible = instructions.classList.contains('show');

      if (isVisible) {
        instructions.classList.remove('show');
        button.innerHTML = '<span>üìù</span> Show Instructions';
      } else {
        instructions.classList.add('show');
        button.innerHTML = '<span>üìù</span> Hide Instructions';
      }
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const themeToggle = document.getElementById('themeToggle');
      if (document.body.classList.contains('dark-mode')) {
        themeToggle.textContent = '‚òÄÔ∏è';
        themeToggle.title = 'Switch to Light Mode';
      } else {
        themeToggle.textContent = 'üåô';
        themeToggle.title = 'Switch to Dark Mode';
      }
    }

    // Initial setup
    document.getElementById('addRowBtn').addEventListener('click', () => {
      if (currentRowCount < maxRows) {
        createRow(currentRowCount);
      }
    });

    document.getElementById('resetTableBtn').addEventListener('click', resetTable);

    // Add event listeners for college fees inputs
    document.getElementById('registrationFee').addEventListener('change', updateCollegeFeesCalculator);
    document.getElementById('lateFee').addEventListener('change', updateCollegeFeesCalculator);
    document.getElementById('otherFees').addEventListener('input', updateOtherFeesCalculator);

    // Dark mode toggle
    document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);

    // Start with one row
    createRow(0);
  </script>
</body>
</html>
