<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tuition & College Fees Calculator</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9f9f9;
      margin: 20px;
    }

    h2 {
      color: #333;
      text-align: center;
      margin-bottom: 25px;
      font-size: 28px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    h3 {
      color: #0066cc;
      border-bottom: 2px solid #0066cc;
      padding-bottom: 8px;
      margin-top: 30px;
    }

    .controls {
      margin-bottom: 10px;
      text-align: center;
    }

    button {
      padding: 10px 16px;
      margin-right: 10px;
      border: none;
      background-color: #0066cc;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    th, td {
      border: 1px solid #e0e0e0;
      padding: 12px;
      text-align: center;
      transition: background-color 0.2s;
    }

    th {
      background-color: #0066cc;
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 14px;
    }

    tr:nth-child(even) {
      background-color: #f8faff;
    }

    tr:hover {
      background-color: #f0f5ff;
    }

    input[type="number"], select {
      padding: 6px;
      width: 100px;
      border-radius: 4px;
      border: 1px solid #ccc;
      transition: border 0.3s;
    }

    input[type="number"]:focus, select:focus {
      border-color: #0066cc;
      outline: none;
      box-shadow: 0 0 5px rgba(0,102,204,0.3);
    }

    .total-display {
      font-weight: bold;
      color: #0066cc;
      font-size: 18px;
    }

    td button {
      background-color: #ff4d4d;
      padding: 6px 12px;
    }

    td button:hover {
      background-color: #ff3333;
    }

    .disclaimer {
      background-color: #fff8e6;
      border-left: 5px solid #ffcc00;
      padding: 15px;
      margin-top: 30px;
      border-radius: 0 5px 5px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      position: relative;
      font-size: 14px;
      line-height: 1.6;
    }

    .disclaimer:before {
      content: "‚ö†Ô∏è";
      position: absolute;
      left: -30px;
      top: 15px;
      font-size: 20px;
    }

    .disclaimer h3 {
      margin-top: 0;
      color: #cc8800;
      border-bottom: 1px solid #e0c800;
      padding-bottom: 8px;
    }

    .disclaimer p {
      margin-bottom: 10px;
    }

    .disclaimer ol, .disclaimer ul {
      margin: 10px 0;
      padding-left: 20px;
    }

    .disclaimer li {
      margin-bottom: 8px;
    }

    .highlight {
      background-color: #e6f7ff;
      font-weight: bold;
    }

    .fee-calculator {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .fee-calculator label {
      display: inline-block;
      width: 200px;
      font-weight: bold;
      margin-right: 10px;
    }

    .fee-calculator input, .fee-calculator select {
      padding: 8px;
      width: 150px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .fee-calculator .total-row {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px solid #0066cc;
      font-size: 18px;
    }
    
    .fee-calculator .reset-btn {
      margin-top: 15px;
      background-color: #ff9900;
    }
    
    .fee-calculator .reset-btn:hover {
      background-color: #e68a00;
    }
    
    .totals-section {
      margin-top: 20px;
      padding: 15px;
      background-color: #f0f7ff;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    /* Payment Plan Section Styles */
    .payment-plan-section {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      margin: 20px 0;
    }
    
    .payment-plan-section h3 {
      margin-top: 0;
    }
    
    .payment-plan-options {
      display: flex;
      gap: 15px;
      margin: 15px 0;
    }
    
    .payment-plan-option {
      flex: 1;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .payment-plan-option:hover {
      border-color: #0066cc;
      background-color: #f0f7ff;
    }
    
    .payment-plan-option.selected {
      border-color: #0066cc;
      background-color: #e6f7ff;
      box-shadow: 0 0 0 2px rgba(0,102,204,0.2);
    }
    
    .payment-plan-option h4 {
      margin-top: 0;
      color: #0066cc;
    }
    
    .payment-plan-option p {
      margin-bottom: 0;
    }
    
    .installment-schedule {
      margin-top: 20px;
    }
    
    .installment-schedule table {
      width: 100%;
    }
    
    .installment-schedule th {
      background-color: #4CAF50;
    }
    
    .payment-summary {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }
    
    .payment-summary h4 {
      margin-top: 0;
      color: #333;
    }
    
    /* Added style for registration fee note */
    .registration-note {
      font-size: 14px;
      color: #666;
      margin-top: -15px;
      margin-bottom: 15px;
      font-style: italic;
    }
    
    /* Agreement Section Styles */
    .agreement-section {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      margin: 20px 0;
      display: none;
    }
    
    .agreement-section h3 {
      margin-top: 0;
    }
    
    .agreement-text {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      background-color: #f9f9f9;
    }
    
    .agreement-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .agreement-form label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .agreement-form input, 
    .agreement-form select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .agreement-form .full-width {
      grid-column: span 2;
    }
    
    .agreement-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* Printable Document Styles */
    .printable-document {
      display: none;
      background-color: white;
      padding: 30px;
      max-width: 800px;
      margin: 20px auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    
    .printable-document h2 {
      text-align: center;
      color: #0066cc;
      margin-bottom: 30px;
    }
    
    .printable-document .student-info {
      margin-bottom: 30px;
    }
    
    .printable-document .student-info p {
      margin: 5px 0;
    }
    
    .printable-document table {
      width: 100%;
      margin-bottom: 30px;
    }
    
    .printable-document .signature-section {
      display: flex;
      justify-content: space-between;
      margin-top: 50px;
    }
    
    .printable-document .signature-box {
      width: 300px;
      height: 100px;
      border-top: 1px solid #000;
      padding-top: 10px;
      text-align: center;
      position: relative;
    }
    
    .printable-document .bursar-info {
      margin-top: 30px;
    }
    
    .printable-document .comments-section {
      margin-top: 30px;
      border-top: 1px solid #000;
      padding-top: 20px;
    }
    
    .printable-document .print-button {
      text-align: center;
      margin-top: 20px;
    }
    
    @media print {
      body * {
        visibility: hidden;
      }
      .printable-document, .printable-document * {
        visibility: visible;
      }
      .printable-document {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
      }
      .no-print {
        display: none;
      }
    }
  </style>
</head>
<body>

<h2>üìä Tuition & College Fees Calculator</h2>

<!-- Collapsible Instructions -->
<button onclick="toggleInstructions()" style="margin-bottom: 10px; background-color: #ddd; color: #333;">Show Instructions</button>
<div id="instructions" style="display: none; background-color: #eef; border-left: 5px solid #0066cc; padding: 15px; max-width: 700px; margin-bottom: 20px; border-radius: 0 5px 5px 0;">
  <strong style="font-size: 16px;">üìù Instructions:</strong><br><br>
  1. <span class="highlight">Use the Tuition Calculator section</span> to calculate your course fees by adding rows for each course.<br>
  2. <span class="highlight">The College Fees Calculator section</span> lets you calculate other college expenses separately from tuition.<br>
  3. <span class="highlight"><strong>GATE Funding</strong> is only available to <strong>Local Nationals</strong> for <strong>Core Courses</strong></span>.<br>
  4. Click <strong>"Add Row"</strong> to include more courses (maximum of 8 rows).<br>
  5. Use <strong>"Reset Table"</strong> to clear the tuition calculator.<br>
  6. <span class="highlight">Payment Plan:</span> Choose between 33%, 44%, or 50% down payment with the remaining balance split into 3 installments.
</div>

<h3>Tuition Calculator</h3>
<div class="controls">
  <button id="addRowBtn">‚ûï Add Row</button>
  <button id="resetTableBtn">üîÑ Reset Table</button>
</div>

<table id="tuitionTable">
  <thead>
    <tr>
      <th>Student Type</th>
      <th>Courses</th>
      <th>Credits</th>
      <th>Tuition Fee</th>
      <th>GATE</th>
      <th>Total</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
  <tfoot>
    <tr>
      <td colspan="6"><strong>Tuition Grand Total</strong></td>
      <td><span id="tuitionGrandTotal" class="total-display">$0.00</span></td>
    </tr>
  </tfoot>
</table>

<h3>College Fees Calculator</h3>
<!-- Added registration fee note here -->
<div class="registration-note">
  <strong>Registration Fee Note:</strong> The registration fee includes a $0 placeholder. Ensure you input the correct amount from your invoice.
</div>
<div class="fee-calculator">
  <div>
    <label for="registrationFee">College Fees:</label>
    <select id="registrationFee">
      <option value="0">$0</option>
      <option value="280">$280</option>
      <option value="410">$410</option>
    </select>
  </div>
  <div>
    <label for="lateFee">Late Fee:</label>
    <select id="lateFee">
      <option value="0">$0</option>
      <option value="50">$50</option>
    </select>
  </div>
  <div>
    <label for="otherFees">Other Fees:</label>
    <input type="number" id="otherFees" min="0" value="0">
  </div>
  <div class="total-row">
    <label>Total College Fees:</label>
    <span id="collegeFeesTotal" class="total-display">$0.00</span>
  </div>
  <button class="reset-btn" onclick="resetCollegeFees()">Reset College Fees</button>
</div>

<div class="totals-section">
  <div>
    <label style="width: 300px;">Tuition Fees Total:</label>
    <span id="displayTuitionTotal" class="total-display">$0.00</span>
  </div>
  <div>
    <label style="width: 300px;">College Fees Total:</label>
    <span id="displayCollegeFeesTotal" class="total-display">$0.00</span>
  </div>
  <div style="margin-top: 10px; font-size: 20px;">
    <label style="width: 300px; font-weight: bold;">Grand Total:</label>
    <span id="grandTotal" class="total-display" style="font-size: 20px;">$0.00</span>
  </div>
</div>

<!-- Payment Plan Section -->
<div class="payment-plan-section">
  <h3>Payment Plan Options</h3>
  
  <p>Select a payment plan option for your tuition fees. College fees must be paid in full upfront.</p>
  
  <div class="payment-plan-options">
    <div class="payment-plan-option" onclick="selectPaymentPlan('full')" id="plan-full">
      <h4>Pay in Full</h4>
      <p>100% upfront payment</p>
    </div>
    <div class="payment-plan-option" onclick="selectPaymentPlan('33')" id="plan-33">
      <h4>33% Down Payment</h4>
      <p>33% down + 3 installments</p>
    </div>
    <div class="payment-plan-option" onclick="selectPaymentPlan('44')" id="plan-44">
      <h4>44% Down Payment</h4>
      <p>44% down + 3 installments</p>
    </div>
    <div class="payment-plan-option" onclick="selectPaymentPlan('50')" id="plan-50">
      <h4>50% Down Payment</h4>
      <p>50% down + 3 installments</p>
    </div>
  </div>
  
  <div class="installment-schedule" id="installmentSchedule" style="display: none;">
    <h4>Payment Schedule</h4>
    <table>
      <thead>
        <tr>
          <th>Payment Type</th>
          <th>Amount</th>
          <th>Due Date</th>
        </tr>
      </thead>
      <tbody id="installmentBody">
        <!-- Will be populated by JavaScript -->
      </tbody>
    </table>
  </div>
  
  <div class="payment-summary">
    <h4>Payment Summary</h4>
    <div>
      <label style="width: 250px;">Tuition Fees Total:</label>
      <span id="payment-tuition-total">$0.00</span>
    </div>
    <div>
      <label style="width: 250px;">College Fees Total:</label>
      <span id="payment-college-total">$0.00</span>
    </div>
    <div>
      <label style="width: 250px;">Down Payment:</label>
      <span id="payment-down-payment">$0.00</span>
    </div>
    <div>
      <label style="width: 250px;">Installment Amount (x3):</label>
      <span id="payment-installment">$0.00</span>
    </div>
    <div style="margin-top: 10px; font-weight: bold;">
      <label style="width: 250px;">Total Amount Payable:</label>
      <span id="payment-total-payable">$0.00</span>
    </div>
  </div>
  
  <div class="controls" style="margin-top: 20px; text-align: center;">
    <button id="agreeButton" onclick="showAgreementSection()">I Agree to Payment Plan</button>
  </div>
</div>

<!-- Agreement Section -->
<div class="agreement-section" id="agreementSection">
  <h3>Payment Agreement</h3>
  
  <div class="agreement-text">
    <p><strong>TERMS AND CONDITIONS OF PAYMENT AGREEMENT</strong></p>
    <p>By signing this agreement, I acknowledge and agree to the following terms:</p>
    <ol>
      <li>I understand that the payment plan is based on the current fee structure and may be subject to change if my course registration changes.</li>
      <li>I agree to make payments according to the schedule outlined in this agreement.</li>
      <li>I understand that failure to make payments by the due dates may result in late fees, holds on my account, or cancellation of my registration.</li>
      <li>I authorize the college to apply any payments first to any outstanding balance, then to current charges.</li>
      <li>I understand that this agreement does not waive any fees or charges associated with my enrollment.</li>
      <li>I agree to notify the Bursar's Office immediately of any changes to my contact information.</li>
    </ol>
    <p><strong>I certify that the information provided is accurate and complete to the best of my knowledge.</strong></p>
  </div>
  
  <form id="studentAgreementForm" class="agreement-form">
    <div>
      <label for="studentName">Student Full Name:</label>
      <input type="text" id="studentName" required>
    </div>
    <div>
      <label for="studentId">Student ID Number:</label>
      <input type="text" id="studentId" required>
    </div>
    <div>
      <label for="phoneNumber">Phone Number:</label>
      <input type="tel" id="phoneNumber" required>
    </div>
    <div>
      <label for="email">Email Address:</label>
      <input type="email" id="email" required>
    </div>
    <div>
      <label for="semester">Semester:</label>
      <select id="semester" required>
        <option value="">Select Semester</option>
        <option value="Semester One">Semester One</option>
        <option value="Semester Two">Semester Two</option>
        <option value="Semester Three">Semester Three</option>
      </select>
    </div>
    <div>
      <label for="semesterType">Semester Type:</label>
      <input type="text" id="semesterType" required placeholder="e.g., 202510, 202520, 202530">
    </div>
    <div>
      <label for="agreementDate">Date:</label>
      <input type="date" id="agreementDate" required>
    </div>
  </form>
  
  <div class="agreement-buttons">
    <button onclick="resetAgreementForm()">Reset Form</button>
    <button onclick="hideAgreementSection()">Cancel</button>
    <button onclick="generateAgreementDocument()" style="background-color: #4CAF50;">Submit Agreement</button>
  </div>
</div>

<!-- Printable Document -->
<div class="printable-document" id="printableDocument">
  <h2>PAYMENT PLAN AGREEMENT</h2>
  
  <div class="student-info">
    <p><strong>Student Name:</strong> <span id="print-student-name"></span></p>
    <p><strong>Student ID:</strong> <span id="print-student-id"></span></p>
    <p><strong>Phone Number:</strong> <span id="print-phone"></span></p>
    <p><strong>Email:</strong> <span id="print-email"></span></p>
    <p><strong>Semester:</strong> <span id="print-semester"></span></p>
    <p><strong>Semester Type:</strong> <span id="print-semester-type"></span></p>
    <p><strong>Date:</strong> <span id="print-date"></span></p>
  </div>
  
  <h3>Payment Plan Details</h3>
  <table>
    <thead>
      <tr>
        <th>Payment Type</th>
        <th>Amount</th>
        <th>Due Date</th>
        <th>Instalment Payment Date (To be filled by Bursar)</th>
        <th>Comments</th>
      </tr>
    </thead>
    <tbody id="print-installment-body">
      <!-- Will be populated by JavaScript -->
    </tbody>
  </table>
  
  <div class="comments-section">
    <h4>Additional Comments</h4>
    <p>________________________________________________________________________________</p>
    <p>________________________________________________________________________________</p>
    <p>________________________________________________________________________________</p>
  </div>
  
  <div class="signature-section">
    <div class="signature-box">
      <p>Student Signature</p>
    </div>
    <div class="signature-box">
      <p>Date: _________________________</p>
    </div>
  </div>
  
  <div class="bursar-info">
    <div style="margin-top: 20px;">
      <p>Bursar Representative Name: _________________________</p>
    </div>
    <div style="margin-top: 40px;">
      <p>Bursar Signature: _________________________</p>
    </div>
    <div style="margin-top: 40px;">
      <p>Date: _________________________</p>
    </div>
  </div>
  
  <div class="print-button no-print">
    <button onclick="window.print()">Print Agreement</button>
    <button onclick="downloadAsPDF()" style="background-color: #4CAF50;">Download as PDF</button>
  </div>
</div>

<div class="disclaimer">
  <h3>Legal Disclaimer</h3>
  <p>The calculations provided by this calculator are <strong>estimates only</strong> and are based on the fees inputted by you, the student, from your invoice.</p>
  <p>This tool serves as a <strong>guidance tool</strong> and does not represent official fees approved by the college.</p>
  <p>The <strong>Bursar's Office</strong> must review and verify all calculations to confirm the accuracy of your payment plan and total amount due.</p>
  
  <p>Additional important information:</p>
  <ol>
    <li>A late fee will be applied if payment is submitted after the college fee deadline (refer to the Academic Calendar)</li>
    <li>All figures are denominated in Trinidad and Tobago Dollars (TTD) unless otherwise specified</li>
    <li>GATE funding calculations are based on current government policies which may be amended</li>
    <li>Final tuition obligations must be verified with the institution's Bursar Department</li>
    <li>Course availability and credit requirements may affect actual fees</li>
  </ol>
  
  <p style="font-weight:bold; border-top:1px solid #ccc; padding-top:10px;">
  This tool does not constitute professional financial advice under the Financial Institutions Act, Chap. 79:09 of Trinidad and Tobago.
  </p>
</div>

<script>
  const studentTypes = ['Local National', 'Caricom National', 'International National'];
  const courseOptions = ['Compass Course', 'Core Course', 'Repeated Course'];
  const gateOptions = ['0%', '25%', '50%', '75%', '100%'];
  const tuitionFees = {
    'Local National': 300,
    'Caricom National': 450,
    'International National': 700
  };
  const allowGate = {
    'Local National': true,
    'Caricom National': false,
    'International National': false
  };

  const maxRows = 8;
  let currentRowCount = 0;
  let lastSelectedType = 'Local National';
  let lastSelectedGate = '0%';
  let selectedPaymentPlan = 'full';

  function createRow(index) {
    if (currentRowCount >= maxRows) return;

    const row = document.createElement('tr');
    row.dataset.index = index;

    // Student Type
    const studentCell = document.createElement('td');
    const studentSelect = document.createElement('select');
    studentTypes.forEach(type => {
      const option = document.createElement('option');
      option.value = type;
      option.text = type;
      if (type === lastSelectedType) option.selected = true;
      studentSelect.appendChild(option);
    });
    studentSelect.addEventListener('change', () => {
      lastSelectedType = studentSelect.value;
      updateRow(index);
    });
    studentCell.appendChild(studentSelect);
    row.appendChild(studentCell);

    // Courses
    const courseCell = document.createElement('td');
    const courseSelect = document.createElement('select');
    courseOptions.forEach(course => {
      const option = document.createElement('option');
      option.value = course;
      option.text = course;
      courseSelect.appendChild(option);
    });
    courseSelect.addEventListener('change', () => updateRow(index));
    courseCell.appendChild(courseSelect);
    row.appendChild(courseCell);

    // Credits
    const creditCell = document.createElement('td');
    const creditInput = document.createElement('input');
    creditInput.type = 'number';
    creditInput.min = 0;
    creditInput.value = 0;
    creditInput.addEventListener('input', () => updateRow(index));
    creditCell.appendChild(creditInput);
    row.appendChild(creditCell);

    // Tuition Fee
    const feeCell = document.createElement('td');
    const feeInput = document.createElement('input');
    feeInput.type = 'number';
    feeInput.readOnly = true;
    feeInput.style.backgroundColor = '#f5f5f5';
    feeInput.style.border = '1px solid #ddd';
    feeCell.appendChild(feeInput);
    row.appendChild(feeCell);

    // GATE
    const gateCell = document.createElement('td');
    const gateSelect = document.createElement('select');
    gateOptions.forEach(optionVal => {
      const option = document.createElement('option');
      option.value = optionVal;
      option.text = optionVal;
      if (optionVal === lastSelectedGate) option.selected = true;
      gateSelect.appendChild(option);
    });
    gateSelect.addEventListener('change', () => {
      lastSelectedGate = gateSelect.value;
      updateRow(index);
    });
    gateCell.appendChild(gateSelect);
    row.appendChild(gateCell);

    // Total
    const totalCell = document.createElement('td');
    const totalSpan = document.createElement('span');
    totalSpan.id = `total-${index}`;
    totalSpan.textContent = '$0.00';
    totalSpan.style.fontWeight = 'bold';
    totalCell.appendChild(totalSpan);
    row.appendChild(totalCell);

    // Clear Button
    const actionCell = document.createElement('td');
    const clearBtn = document.createElement('button');
    clearBtn.textContent = '‚ùå Clear';
    clearBtn.addEventListener('click', () => clearRow(index));
    actionCell.appendChild(clearBtn);
    row.appendChild(actionCell);

    document.getElementById('tableBody').appendChild(row);
    currentRowCount++;
    updateRow(index);

    if (currentRowCount >= maxRows) {
      document.getElementById('addRowBtn').disabled = true;
    }
  }

  function updateRow(index) {
    const row = document.getElementById('tableBody').rows[index];
    if (!row) return;

    const studentType = row.cells[0].querySelector('select').value;
    const courseType = row.cells[1].querySelector('select').value;
    const credits = parseFloat(row.cells[2].querySelector('input').value) || 0;
    const feeInput = row.cells[3].querySelector('input');
    const gateSelect = row.cells[4].querySelector('select');

    const tuitionFee = tuitionFees[studentType];
    feeInput.value = tuitionFee;

    // Disable GATE if not Local National OR if Compass Course or Repeated Course is selected
    const isCompassOrRepeated = courseType === 'Compass Course' || courseType === 'Repeated Course';
    const isLocalNational = studentType === 'Local National';
    
    gateSelect.disabled = !isLocalNational || isCompassOrRepeated;
    
    // If Compass Course or Repeated Course is selected, force GATE to 0%
    if (isCompassOrRepeated) {
      gateSelect.value = '0%';
    }

    const gateVal = gateSelect.value;
    const gateMap = {
      '0%': 1,
      '25%': 0.75,
      '50%': 0.5,
      '75%': 0.25,
      '100%': 0
    };
    const gateMultiplier = (isLocalNational && !isCompassOrRepeated) ? gateMap[gateVal] : 1;

    const total = credits * tuitionFee * gateMultiplier;
    document.getElementById(`total-${index}`).textContent = `$${total.toFixed(2)}`;

    computeTuitionGrandTotal();
    updateTotalsSection();
    updatePaymentPlan();
  }

  function computeTuitionGrandTotal() {
    let total = 0;
    for (let i = 0; i < currentRowCount; i++) {
      const totalText = document.getElementById(`total-${i}`)?.textContent || '$0';
      total += parseFloat(totalText.replace('$', '')) || 0;
    }
    document.getElementById('tuitionGrandTotal').textContent = `$${total.toFixed(2)}`;
    document.getElementById('displayTuitionTotal').textContent = `$${total.toFixed(2)}`;
    updateGrandTotal();
    updatePaymentPlan();
  }

  function updateCollegeFeesCalculator() {
    const registrationFee = parseFloat(document.getElementById('registrationFee').value) || 0;
    const lateFee = parseFloat(document.getElementById('lateFee').value) || 0;
    const otherFees = parseFloat(document.getElementById('otherFees').value) || 0;
    
    const totalCollegeFees = registrationFee + lateFee + otherFees;
    
    document.getElementById('collegeFeesTotal').textContent = `$${totalCollegeFees.toFixed(2)}`;
    document.getElementById('displayCollegeFeesTotal').textContent = `$${totalCollegeFees.toFixed(2)}`;
    updateGrandTotal();
    updatePaymentPlan();
  }

  function updateTotalsSection() {
    updateCollegeFeesCalculator();
    updateGrandTotal();
  }

  function updateGrandTotal() {
    const tuitionTotal = parseFloat(document.getElementById('displayTuitionTotal').textContent.replace('$', '')) || 0;
    const collegeFeesTotal = parseFloat(document.getElementById('displayCollegeFeesTotal').textContent.replace('$', '')) || 0;
    const grandTotal = tuitionTotal + collegeFeesTotal;
    document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
    updatePaymentPlan();
  }

  function resetCollegeFees() {
    document.getElementById('registrationFee').value = '0';
    document.getElementById('lateFee').value = '0';
    document.getElementById('otherFees').value = '0';
    
    updateCollegeFeesCalculator();
  }

  function clearRow(index) {
    const row = document.getElementById('tableBody').rows[index];
    if (!row) return;

    row.cells[1].querySelector('select').value = courseOptions[0];
    row.cells[2].querySelector('input').value = 0;
    row.cells[3].querySelector('input').value = tuitionFees[lastSelectedType];
    row.cells[4].querySelector('select').value = lastSelectedGate;
    document.getElementById(`total-${index}`).textContent = '$0.00';

    updateRow(index);
  }

  function resetTable() {
    document.getElementById('tableBody').innerHTML = '';
    document.getElementById('tuitionGrandTotal').textContent = '$0.00';
    document.getElementById('displayTuitionTotal').textContent = '$0.00';
    currentRowCount = 0;
    document.getElementById('addRowBtn').disabled = false;
    createRow(0);
    updateTotalsSection();
    updatePaymentPlan();
  }

  function toggleInstructions() {
    const instructions = document.getElementById('instructions');
    const button = event.target;
    const isVisible = instructions.style.display === 'block';

    instructions.style.display = isVisible ? 'none' : 'block';
    button.textContent = isVisible ? 'Show Instructions' : 'Hide Instructions';
  }

  function selectPaymentPlan(plan) {
    selectedPaymentPlan = plan;
    
    // Update UI to show selected plan
    document.querySelectorAll('.payment-plan-option').forEach(option => {
      option.classList.remove('selected');
    });
    document.getElementById(`plan-${plan}`).classList.add('selected');
    
    updatePaymentPlan();
  }

  function updatePaymentPlan() {
    const tuitionTotal = parseFloat(document.getElementById('displayTuitionTotal').textContent.replace('$', '')) || 0;
    const collegeFeesTotal = parseFloat(document.getElementById('displayCollegeFeesTotal').textContent.replace('$', '')) || 0;
    
    // Update payment summary
    document.getElementById('payment-tuition-total').textContent = `$${tuitionTotal.toFixed(2)}`;
    document.getElementById('payment-college-total').textContent = `$${collegeFeesTotal.toFixed(2)}`;
    
    let downPayment = 0;
    let installmentAmount = 0;
    let installmentBody = document.getElementById('installmentBody');
    installmentBody.innerHTML = '';
    
    if (selectedPaymentPlan === 'full') {
      // Full payment option
      document.getElementById('installmentSchedule').style.display = 'none';
      downPayment = tuitionTotal + collegeFeesTotal;
      installmentAmount = 0;
      
      // Update summary
      document.getElementById('payment-down-payment').textContent = `$${downPayment.toFixed(2)}`;
      document.getElementById('payment-installment').textContent = '$0.00';
      document.getElementById('payment-total-payable').textContent = `$${downPayment.toFixed(2)}`;
    } else {
      // Installment plan option
      document.getElementById('installmentSchedule').style.display = 'block';
      const downPaymentPercent = parseInt(selectedPaymentPlan) / 100;
      downPayment = (tuitionTotal * downPaymentPercent) + collegeFeesTotal;
      const remainingBalance = tuitionTotal - (tuitionTotal * downPaymentPercent);
      installmentAmount = remainingBalance / 3;
      
      // Update summary
      document.getElementById('payment-down-payment').textContent = `$${downPayment.toFixed(2)}`;
      document.getElementById('payment-installment').textContent = `$${installmentAmount.toFixed(2)}`;
      document.getElementById('payment-total-payable').textContent = `$${(downPayment + (installmentAmount * 3)).toFixed(2)}`;
      
      // Create installment schedule
      // Down payment row
      const downPaymentRow = document.createElement('tr');
      downPaymentRow.innerHTML = `
        <td>Down Payment (${selectedPaymentPlan}%) + College Fees</td>
        <td>$${downPayment.toFixed(2)}</td>
        <td>Due at registration</td>
      `;
      installmentBody.appendChild(downPaymentRow);
      
      // Installment rows
      for (let i = 1; i <= 3; i++) {
        const installmentRow = document.createElement('tr');
        installmentRow.innerHTML = `
          <td>Installment ${i} of 3</td>
          <td>$${installmentAmount.toFixed(2)}</td>
          <td>Due ${i} month${i > 1 ? 's' : ''} after registration</td>
        `;
        installmentBody.appendChild(installmentRow);
      }
    }
  }

  function showAgreementSection() {
    document.getElementById('agreementSection').style.display = 'block';
    // Set today's date as default
    const today = new Date();
    const dateStr = today.toISOString().split('T')[0];
    document.getElementById('agreementDate').value = dateStr;
    
    // Scroll to the agreement section
    document.getElementById('agreementSection').scrollIntoView({ behavior: 'smooth' });
  }

  function hideAgreementSection() {
    document.getElementById('agreementSection').style.display = 'none';
  }

  function resetAgreementForm() {
    document.getElementById('studentAgreementForm').reset();
    // Reset date to today
    const today = new Date();
    const dateStr = today.toISOString().split('T')[0];
    document.getElementById('agreementDate').value = dateStr;
  }

  function generateAgreementDocument() {
    // Validate form
    const form = document.getElementById('studentAgreementForm');
    if (!form.checkValidity()) {
      alert('Please fill in all required fields');
      return;
    }
    
    // Get form values
    const studentName = document.getElementById('studentName').value;
    const studentId = document.getElementById('studentId').value;
    const phoneNumber = document.getElementById('phoneNumber').value;
    const email = document.getElementById('email').value;
    const semester = document.getElementById('semester').value;
    const semesterType = document.getElementById('semesterType').value;
    const agreementDate = document.getElementById('agreementDate').value;
    
    // Format date for display
    const formattedDate = new Date(agreementDate).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    
    // Populate printable document
    document.getElementById('print-student-name').textContent = studentName;
    document.getElementById('print-student-id').textContent = studentId;
    document.getElementById('print-phone').textContent = phoneNumber;
    document.getElementById('print-email').textContent = email;
    document.getElementById('print-semester').textContent = semester;
    document.getElementById('print-semester-type').textContent = semesterType;
    document.getElementById('print-date').textContent = formattedDate;
    
    // Populate payment schedule in printable document
    const printInstallmentBody = document.getElementById('print-installment-body');
    printInstallmentBody.innerHTML = '';
    
    const tuitionTotal = parseFloat(document.getElementById('displayTuitionTotal').textContent.replace('$', '')) || 0;
    const collegeFeesTotal = parseFloat(document.getElementById('displayCollegeFeesTotal').textContent.replace('$', '')) || 0;
    
    if (selectedPaymentPlan === 'full') {
      // Full payment option
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>Full Payment + College Fees</td>
        <td>$${(tuitionTotal + collegeFeesTotal).toFixed(2)}</td>
        <td>Due at registration</td>
        <td>_________________________</td>
        <td>_________________________</td>
      `;
      printInstallmentBody.appendChild(row);
    } else {
      // Installment plan option
      const downPaymentPercent = parseInt(selectedPaymentPlan) / 100;
      const downPayment = (tuitionTotal * downPaymentPercent) + collegeFeesTotal;
      const remainingBalance = tuitionTotal - (tuitionTotal * downPaymentPercent);
      const installmentAmount = remainingBalance / 3;
      
      // Down payment row
      const downPaymentRow = document.createElement('tr');
      downPaymentRow.innerHTML = `
        <td>Down Payment (${selectedPaymentPlan}%) + College Fees</td>
        <td>$${downPayment.toFixed(2)}</td>
        <td>Due at registration</td>
        <td>_________________________</td>
        <td>_________________________</td>
      `;
      printInstallmentBody.appendChild(downPaymentRow);
      
      // Installment rows
      for (let i = 1; i <= 3; i++) {
        const installmentRow = document.createElement('tr');
        installmentRow.innerHTML = `
          <td>Installment ${i} of 3</td>
          <td>$${installmentAmount.toFixed(2)}</td>
          <td>Due ${i} month${i > 1 ? 's' : ''} after registration</td>
          <td>_________________________</td>
          <td>_________________________</td>
        `;
        printInstallmentBody.appendChild(installmentRow);
      }
    }
    
    // Show the printable document
    document.getElementById('printableDocument').style.display = 'block';
    document.getElementById('agreementSection').style.display = 'none';
    
    // Scroll to the printable document
    document.getElementById('printableDocument').scrollIntoView({ behavior: 'smooth' });
  }

  function downloadAsPDF() {
    // In a real implementation, you would use a library like jsPDF or html2pdf.js
    // This is just a placeholder for the functionality
    alert('In a real implementation, this would generate a PDF download. For now, please use the Print function and choose "Save as PDF" as your printer.');
  }

  // Initial setup
  document.getElementById('addRowBtn').addEventListener('click', () => {
    if (currentRowCount < maxRows) {
      createRow(currentRowCount);
    }
  });

  document.getElementById('resetTableBtn').addEventListener('click', resetTable);

  // Add event listeners for college fees inputs
  document.getElementById('registrationFee').addEventListener('change', updateCollegeFeesCalculator);
  document.getElementById('lateFee').addEventListener('change', updateCollegeFeesCalculator);
  document.getElementById('otherFees').addEventListener('input', updateCollegeFeesCalculator);

  // Start with one row and select full payment by default
  createRow(0);
  selectPaymentPlan('full');
</script>

</body>
</html>