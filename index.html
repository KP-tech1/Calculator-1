<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> COSTAATT| COSTAATT Bursar Department</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root {
      --primary-color: #6a0dad;
      --secondary-color: #ff7043;
      --accent-color: #ff9800;
      --light-bg: #f9f9f9;
      --dark-bg: #1a1a2e;
      --dark-card: #16213e;
      --dark-text: #e6e6e6;
      --light-text: #333;
      --shadow: 0 5px 15px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
    }

    .dark-mode {
      --light-bg: var(--dark-bg);
      --light-text: var(--dark-text);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: var(--transition);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light-bg);
      color: var(--light-text);
      line-height: 1.6;
      padding: 20px;
      transition: var(--transition);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      border-radius: 15px;
      background: linear-gradient(135deg, var(--primary-color), #8a2be2);
      color: white;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      z-index: 0;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      position: relative;
      z-index: 1;
    }

    header p {
      font-size: 1.2rem;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }

    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
      z-index: 1;
      transition: var(--transition);
    }

    .theme-toggle:hover {
      transform: rotate(30deg);
      background: rgba(255,255,255,0.3);
    }

    .calculator-card {
      background-color: white;
      border-radius: 15px;
      box-shadow: var(--shadow);
      padding: 25px;
      margin-bottom: 25px;
      transition: var(--transition);
    }

    .dark-mode .calculator-card {
      background-color: var(--dark-card);
    }

    h2, h3 {
      color: var(--primary-color);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
    }

    .dark-mode h2, .dark-mode h3 {
      color: var(--secondary-color);
    }

    h2::before, h3::before {
      margin-right: 10px;
      font-size: 1.5em;
    }

    h2::before {
      content: "üìä";
    }

    h3::before {
      content: "üí∞";
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background-color: #5a0b9d;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .btn-secondary {
      background-color: var(--secondary-color);
      color: white;
    }

    .btn-secondary:hover {
      background-color: #e65c3e;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .btn-accent {
      background-color: var(--accent-color);
      color: white;
    }

    .btn-accent:hover {
      background-color: #e68900;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .dark-mode table {
      background-color: var(--dark-card);
    }

    th, td {
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
    }

    .dark-mode th, .dark-mode td {
      border-bottom: 1px solid #2d3746;
    }

    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 14px;
    }

    tr:nth-child(even) {
      background-color: #f8f4ff;
    }

    .dark-mode tr:nth-child(even) {
      background-color: #1f2a40;
    }

    tr:hover {
      background-color: #f0e5ff;
    }

    .dark-mode tr:hover {
      background-color: #2a3650;
    }

    input, select {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ddd;
      transition: var(--transition);
      width: 100%;
    }

    .dark-mode input, .dark-mode select {
      background-color: #2d3746;
      border-color: #3a4558;
      color: var(--dark-text);
    }

    input:focus, select:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 5px rgba(106,13,173,0.3);
    }

    .total-display {
      font-weight: bold;
      color: var(--primary-color);
      font-size: 18px;
    }

    .dark-mode .total-display {
      color: var(--secondary-color);
    }

    .fee-calculator {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .fee-item {
      display: flex;
      flex-direction: column;
    }

    .fee-item label {
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--primary-color);
    }

    .dark-mode .fee-item label {
      color: var(--secondary-color);
    }

    .fee-input {
      position: relative;
    }

    .fee-input::before {
      content: "$";
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
    }

    .fee-input input {
      padding-left: 25px;
    }

    .totals-section {
      background-color: #f3e5f5;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .dark-mode .totals-section {
      background-color: #2a1b3d;
    }

    .totals-section div {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .grand-total {
      font-size: 24px;
      font-weight: bold;
      border-top: 2px solid var(--primary-color);
      padding-top: 15px;
      margin-top: 15px;
    }

    .dark-mode .grand-total {
      border-top-color: var(--secondary-color);
    }

    .disclaimer {
      background-color: #fff8e6;
      border-left: 5px solid #ffa726;
      padding: 20px;
      margin-top: 30px;
      border-radius: 0 10px 10px 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .dark-mode .disclaimer {
      background-color: #332b1a;
      border-left-color: #e68900;
    }

    .disclaimer h3 {
      margin-top: 0;
      color: #e65100;
      border-bottom: 1px solid #e0c800;
      padding-bottom: 10px;
    }

    .dark-mode .disclaimer h3 {
      color: #ffa726;
    }

    .disclaimer p {
      margin-bottom: 15px;
    }

    .disclaimer ol {
      margin: 15px 0;
      padding-left: 20px;
    }

    .disclaimer li {
      margin-bottom: 10px;
    }

    .course-type-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }

    .dark-mode .course-type-tabs {
      border-bottom-color: #3a4558;
    }

.notice-tab {
  background-color: #ffeb3b !important;
  color: #333 !important;
  border: 1px solid #ffc107 !important;
}

.notice-tab:hover {
  background-color: #fdd835 !important;
  transform: translateY(-2px);
}

.notice-popup {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  z-index: 1000;
  max-width: 900px;
  width: 95%;
  max-height: 90vh;
  overflow-y: auto;
}

.dark-mode .notice-popup {
  background: var(--dark-card);
  color: var(--dark-text);
}

.notice-popup.show {
  display: block;
}

.notice-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 999;
}

.notice-overlay.show {
  display: block;
}

.notice-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 3px solid var(--primary-color);
}

.dark-mode .notice-header {
  border-bottom-color: var(--secondary-color);
}

.notice-content {
  line-height: 1.6;
  font-size: 14px;
}

.notice-content h3 {
  color: var(--primary-color);
  margin: 25px 0 15px 0;
  font-size: 1.3rem;
  border-bottom: 2px solid #e0e0e0;
  padding-bottom: 8px;
}

.dark-mode .notice-content h3 {
  color: var(--secondary-color);
  border-bottom-color: #3a4558;
}

.notice-content h4 {
  color: var(--primary-color);
  margin: 20px 0 10px 0;
  font-size: 1.1rem;
}

.dark-mode .notice-content h4 {
  color: var(--secondary-color);
}

.notice-content ul, .notice-content ol {
  margin: 10px 0 15px 0;
  padding-left: 30px;
}

.notice-content li {
  margin-bottom: 8px;
  line-height: 1.5;
}

.notice-content p {
  margin-bottom: 15px;
}

.notice-content .sub-list {
  padding-left: 20px;
  margin: 5px 0;
}

.notice-content .declaration-section {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  border-left: 4px solid var(--primary-color);
  margin: 20px 0;
}

.dark-mode .notice-content .declaration-section {
  background: #2a1b3d;
  border-left-color: var(--secondary-color);
}

.notice-content .payment-methods {
  background: #e8f4fd;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
}

.dark-mode .notice-content .payment-methods {
  background: #1a2e3d;
}

.close-notice {
  background: none;
  border: none;
  font-size: 28px;
  cursor: pointer;
  color: var(--primary-color);
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: var(--transition);
}

.close-notice:hover {
  background-color: rgba(0,0,0,0.1);
}

.dark-mode .close-notice {
  color: var(--secondary-color);
}

.dark-mode .close-notice:hover {
  background-color: rgba(255,255,255,0.1);
}

.notice-intro {
  font-weight: bold;
  margin-bottom: 20px;
  padding: 15px;
  background: #fff3cd;
  border-radius: 8px;
  border-left: 4px solid #ffc107;
}

.dark-mode .notice-intro {
  background: #332b1a;
  border-left-color: #e68900;
}

.agreement-footer {
  margin-top: 30px;
  padding-top: 20px;
  border-top: 2px solid #e0e0e0;
  text-align: center;
}

.dark-mode .agreement-footer {
  border-top-color: #3a4558;
}

.agree-btn {
  background: linear-gradient(135deg, #4CAF50, #45a049);
  color: white;
  border: none;
  padding: 15px 40px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
}

.agree-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
  background: linear-gradient(135deg, #45a049, #4CAF50);
}

.student-info-form {
  background: #f8f9fa;
  padding: 25px;
  border-radius: 10px;
  margin: 20px 0;
  border-left: 4px solid var(--primary-color);
}

.dark-mode .student-info-form {
  background: #2a1b3d;
  border-left-color: var(--secondary-color);
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: bold;
  color: var(--primary-color);
}

.dark-mode .form-group label {
  color: var(--secondary-color);
}

.form-group input {
  width: 100%;
  padding: 12px;
  border: 2px solid #ddd;
  border-radius: 6px;
  font-size: 16px;
  transition: var(--transition);
}

.dark-mode .form-group input {
  background: var(--dark-card);
  border-color: #3a4558;
  color: var(--dark-text);
}

.form-group input:focus {
  border-color: var(--primary-color);
  outline: none;
  box-shadow: 0 0 8px rgba(106, 13, 173, 0.3);
}

.agreement-status {
  background: linear-gradient(135deg, #e8f5e8, #d4edda);
  padding: 15px;
  border-radius: 8px;
  margin: 15px 0;
  border-left: 4px solid #28a745;
  display: none;
}

.dark-mode .agreement-status {
  background: linear-gradient(135deg, #1a331a, #155724);
  border-left-color: #20c997;
}

.download-section {
  background: linear-gradient(135deg, #e3f2fd, #bbdefb);
  padding: 20px;
  border-radius: 10px;
  margin: 20px 0;
  border-left: 4px solid #2196F3;
  display: none;
}

.dark-mode .download-section {
  background: linear-gradient(135deg, #1a237e, #283593);
  border-left-color: #2196F3;
}

.download-btn {
  background: linear-gradient(135deg, #2196F3, #1976D2);
  color: white;
  border: none;
  padding: 12px 30px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 0 auto;
}

.download-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
  background: linear-gradient(135deg, #1976D2, #1565C0);
}

.student-info-display {
  background: #fff3cd;
  padding: 15px;
  border-radius: 8px;
  margin: 15px 0;
  border: 2px solid #ffc107;
  display: none;
}

.dark-mode .student-info-display {
  background: #332b1a;
  border-color: #e68900;
}

@media (max-width: 768px) {
  .notice-popup {
    padding: 20px;
    width: 98%;
  }
  
  .notice-content {
    font-size: 13px;
  }
  
  .agree-btn {
    padding: 12px 30px;
    font-size: 14px;
  }
}
.pdf-download-btn {
  background: linear-gradient(135deg, #d32f2f, #b71c1c);
  color: white;
  border: none;
  padding: 12px 25px;
  font-size: 16px;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3);
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 10px;
}

.pdf-download-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);
  background: linear-gradient(135deg, #b71c1c, #c62828);
}

.pdf-preview {
  background: white;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  padding: 20px;
  margin: 15px 0;
  max-height: 300px;
  overflow-y: auto;
  display: none;
}

.dark-mode .pdf-preview {
  background: var(--dark-card);
  border-color: #3a4558;
}

.pdf-preview-content {
  font-family: 'Arial', sans-serif;
  line-height: 1.4;
}

.pdf-header {
  text-align: center;
  border-bottom: 3px solid #6a0dad;
  padding-bottom: 15px;
  margin-bottom: 20px;
}

.pdf-section {
  margin-bottom: 20px;
  padding: 15px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  background: #f9f9f9;
}

.dark-mode .pdf-section {
  background: #2a1b3d;
  border-color: #3a4558;
}

.pdf-totals {
  background: #e8f5e8 !important;
  border-left: 4px solid #4caf50 !important;
}

.dark-mode .pdf-totals {
  background: #1a331a !important;
  border-left-color: #4caf50 !important;
}

.pdf-agreement {
  background: #fff3cd !important;
  border-left: 4px solid #ff9800 !important;
}

.dark-mode .pdf-agreement {
  background: #332b1a !important;
  border-left-color: #ff9800 !important;
}

.pdf-footer {
  text-align: center;
  margin-top: 20px;
  padding-top: 15px;
  border-top: 2px dashed #ccc;
  font-size: 12px;
  color: #666;
}

.download-options {
  display: flex;
  justify-content: center;
  gap: 15px;
  flex-wrap: wrap;
  margin-top: 15px;
}

    .course-type-tab {
      padding: 12px 24px;
      cursor: pointer;
      background-color: #f1f1f1;
      border: 1px solid #ddd;
      border-bottom: none;
      margin-right: 5px;
      border-radius: 8px 8px 0 0;
      transition: var(--transition);
    }

    .dark-mode .course-type-tab {
      background-color: #2d3746;
      border-color: #3a4558;
      color: var(--dark-text);
    }

    .course-type-tab.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .dark-mode .course-type-tab.active {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
    }

    .short-courses-section {
      display: none;
    }

    .instructions {
      background-color: #ede7f6;
      border-left: 5px solid var(--primary-color);
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 0 10px 10px 0;
      display: none;
    }

    .dark-mode .instructions {
      background-color: #2a1b3d;
      border-left-color: var(--secondary-color);
    }

    .instructions.show {
      display: block;
    }

    @media (max-width: 768px) {
      .fee-calculator {
        grid-template-columns: 1fr;
      }
      
      .course-type-tabs {
        flex-direction: column;
      }
      
      .course-type-tab {
        border-radius: 8px;
        margin-bottom: 5px;
      }
      
      header h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <button class="theme-toggle" id="themeToggle">üåô</button>
      <h1>COSTAATT</h1>
      <p>Student Calculator by COSTAATT Bursar Department</p>
    </header>

    <button class="btn-accent" onclick="toggleInstructions()" style="margin-bottom: 20px;">
      <span>üìù</span> Show Instructions
    </button>

    <div class="instructions" id="instructions">
  <strong style="font-size: 16px;">üìù Instructions:</strong><br><br>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">1.</span>
    <span><span class="highlight">Please use the fee calculator‚Äîwhich accounts for</span>tuition, college, and other applicable fees‚Äîto calculate your next payment to COSTAATT.</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">2.</span>
    <span><span class="highlight">GATE Programme</span>provides financial assistance to citizens of Trinidad and Tobago,<span class="highlight">who are pursuing GATE-approved tertiary level programmes at COSTAATT.</span></span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">3.</span>
    <span><span class="highlight">COMPASS Courses</span>are<span class="highlight">only GATE-funded</span> if you're registered in the COMPASS Programme.</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">4.</span>
    <span><span class="highlight">Please note that GATE does not cover</span> the cost of withdrawn and repeated courses. These are self-funded courses that must be paid by the Academic Calendar Deadline.</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">5.</span>
    <span>If you are a <span class="highlight">Postgraduate student</span>,select the<span class="highlight">Postgraduate</span> tab to calculate your next fee payment.</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">6.</span>
    <span>Click <span class="highlight">Add Row</span> to include more courses (up to a maximum of <span class="highlight">8 rows</span>).</span>
  </div>
  
  <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
    <span style="margin-right: 8px;">7.</span>
    <span>Click <span class="highlight">Reset Table</span> to clear your entries and start over.</span>
  </div>
</div>

<div class="course-type-tabs">
  <div class="course-type-tab active" id="undergradTab" onclick="switchCourseType('undergrad')">Undergraduate Courses</div>
  <div class="course-type-tab" id="gradTab" onclick="switchCourseType('grad')">Postgraduate Courses</div>
  <div class="course-type-tab notice-tab" onclick="showPaymentNotice()">
    <span>üìÑ</span> View Terms
  </div>
</div>

<!-- Agreement Status Display -->
<div class="agreement-status" id="agreementStatus">
  <div style="display: flex; align-items: center; gap: 15px;">
    <span style="font-size: 24px;">‚úÖ</span>
    <div>
      <strong>Financial Responsibility Agreement Accepted</strong><br>
      <span id="agreementDetails">By: [Student Name] | ID: [Student ID] | Date: [Agreement Date]</span>
    </div>
  </div>
</div>

<!-- Student Info Display -->
<div class="student-info-display" id="studentInfoDisplay">
  <strong>Student Information:</strong><br>
  <span id="displayStudentName"></span> | <span id="displayStudentId"></span>
</div>

<!-- Download Section -->
<div class="download-section" id="downloadSection">
  <div style="text-align: center;">
    <h4 style="margin-bottom: 15px; color: #1976D2;">üìä Download Your Fee Calculation</h4>
    <p style="margin-bottom: 20px;">Download a professional PDF report of your fees including your agreement to the financial terms.</p>
    
    <div class="download-options">
      <button class="download-btn" onclick="generatePDFReport()">
        </span> Download PDF Report
      </button>
      <button class="pdf-download-btn" onclick="previewPDF()">
        </span> Preview PDF
      </button>
    </div>
    
    <div class="pdf-preview" id="pdfPreview">
      <div class="pdf-preview-content" id="pdfPreviewContent">
        <!-- PDF content will be generated here -->
      </div>
    </div>
  </div>
</div>

<!-- Notice Popup -->
<div class="notice-overlay" id="noticeOverlay" onclick="closePaymentNotice()"></div>
<div class="notice-popup" id="noticePopup">
  <div class="notice-header">
    <h3>COSTAATT PAYMENT TERMS AND STUDENT FINANCIAL RESPONSIBILITY AGREEMENT</h3>
    <button class="close-notice" onclick="closePaymentNotice()">√ó</button>
  </div>
  <div class="notice-content">
    <div class="notice-intro">
      <strong>Dear Student,</strong><br><br>
      COSTAATT offers training programmes that are both GATE-funded and non-GATE-funded. Regardless of funding status, all students are financially responsible for the full and timely payment of tuition, college fees, and any other applicable fees, in accordance with the deadlines outlined in the Academic Calendar.
    </div>

    <!-- Your document content remains exactly the same -->
    <h3>1. GATE Funding and Student Responsibility</h3>
    <ul>
      <li>Students may be eligible for 100%, 75%, or 50% GATE funding, depending on the programme and their GATE status.</li>
      <li>Even when tuition or fees are expected to be covered by GATE or another sponsor, students remain ultimately responsible for settling any unpaid balance.</li>
    </ul>
    <p>GATE does not cover the cost of withdrawn courses, repeated courses, or COMPASS level courses for students enrolled in programmes other than the COMPASS Certificate programme.</p>
    <p>Students must pay the full tuition for all withdrawn, repeated, or COMPASS courses, where necessary, by the tuition payment deadline for the relevant semester.</p>

    <h3>2. GATE Application Deadline</h3>
    <ul>
      <li>Students who wish to access GATE funding must submit their GATE application by the deadline stated on the Academic Calendar.</li>
      <li>Failure to submit the GATE application on time will result in the student being fully responsible for payment of tuition for that semester.</li>
      <li>Students are strongly advised to review the Academic Calendar regularly and adhere to all relevant GATE and fee-related deadlines.</li>
    </ul>

    <h3>3. Types of Fees</h3>
    
    <h4>a) Tuition Fees</h4>
    <ul>
      <li>Tuition covers instructional costs and may be fully or partially covered by GATE or another approved sponsor.</li>
      <li>Any unfunded portion of tuition is the responsibility of the student and must be paid by the published deadline stated in the Academic Calendar.</li>
    </ul>

    <h4>b) College Fees</h4>
    <ul>
      <li>College fees are mandatory institutional charges automatically applied to a student's account upon registration for courses.</li>
      <li>If a student drops all courses within the official Add/Drop period (as stated in the Academic Calendar), college fees for that semester, minus the registration fee, will be reversed.</li>
      <li>If a student withdraws after the Add/Drop period, college fees will remain payable and must be paid in full.</li>
      <li>College fees are normally non-refundable. However, where withdrawal from the College occurs within the deadline for the Add/Drop period, college fees, minus the registration fee, may qualify for a refund.</li>
      <li>College fees are not transferable to another student under any circumstances.</li>
    </ul>

    <h4>c) Other Fees</h4>
    <ul>
      <li>Additional fees may be charged throughout the semester, depending on the student's activity or circumstances. These may include:
        <ul class="sub-list">
          <li>Lab or course materials fees</li>
          <li>Late payment fees</li>
          <li>Administrative charges for services such as transcripts, letters, or replacement ID cards, etc.</li>
        </ul>
      </li>
      <li>Students are responsible for monitoring their financial accounts and ensuring that all fees are paid promptly as they are assessed.</li>
    </ul>

    <h3>4. Payment Deadlines and Financial Holds</h3>
    <ul>
      <li>All tuition, college fees, and other applicable charges must be paid by the published deadlines in the Academic Calendar.</li>
      <li>Students who fail to meet payment deadlines will have a financial hold placed on their accounts. This financial hold may and/or will block:
        <ul class="sub-list">
          <li>Access to classes</li>
          <li>Future course registration</li>
          <li>Viewing of grades</li>
          <li>Issuance of transcripts, letters, diplomas, or other official documents</li>
          <li>Access to other administrative and student service</li>
        </ul>
      </li>
    </ul>

    <h3>5. Student Financial Responsibility</h3>
    <p>It is the responsibility of all students of COSTAATT to:</p>
    <ul>
      <li>Familiarize themselves with the Academic Calendar and strictly adhere to all payment and application deadlines.</li>
      <li>Monitor their student account regularly for tuition balances, college fees, and other charges.</li>
      <li>Submit all GATE applications and supporting documents on time.</li>
      <li>Settle any self-funded tuition, college fees, and other fees by the applicable deadlines.</li>
      <li>Take full and personal responsibility for the timely maintenance of their student account throughout their time at the College.</li>
    </ul>

    <div class="payment-methods">
      <h3>6. Payment Methods</h3>
      <p>Before making any payment, please ensure you have the following details ready:</p>
      <ul>
        <li>Your 8-digit student ID</li>
        <li>Amount to be paid</li>
        <li>Relevant term/semester code (e.g., 202610)</li>
      </ul>

      <h4>Accepted Methods of Payment:</h4>
      <ol>
        <li><strong>Personal Online Banking (FCB and RBL only)</strong>
          <ul class="sub-list">
            <li>Login to your online banking account.</li>
            <li>Add COSTAATT as a payee.</li>
            <li>Include in your payment description: your student ID, type of fee, and term/semester.</li>
          </ul>
        </li>
        <li><strong>Inter-Bank Transfer Online</strong>
          <ul class="sub-list">
            <li>Login to your online banking.</li>
            <li>Transfer funds to:<br><strong>First Citizens Bank ‚Äì Account Number: 1210236</strong></li>
            <li>Include your student ID, type of fee, and term/semester in the description.</li>
          </ul>
        </li>
        <li><strong>In-Person Payments (LINX and Credit Card only)</strong>
          <ul class="sub-list">
            <li>Accepted at COSTAATT campus cashier stations.</li>
            <li>Cash payments are not accepted.</li>
            <li>LINX (debit) and credit card only.</li>
          </ul>
        </li>
        <li><strong>COSTAATT's ePay Service (more details to follow)</strong></li>
      </ol>

      <h4>After Payment:</h4>
      <ul>
        <li>Retain a printout, photograph, or screenshot of your payment receipt.</li>
        <li>For payments not made via COSTAATT's online payment portal or in-person at a COSTAATT campus, email proof of payment to: <strong>payments@costaatt.edu.tt</strong></li>
        <li>Monitor your student email for confirmation that your payment was received and processed.</li>
      </ul>
      <p><strong>Note:</strong> It is extremely important that all payment details are provided correctly. Incomplete or incorrect information will delay processing, as the Bursar's Office must verify the payee's identity, payment type, and semester prior to posting the payment.</p>
    </div>

    <div class="declaration-section">
      <h3>STUDENT DECLARATION ON FINANCIAL RESPONSIBILITY</h3>
      <p>I have read, understood, and agree to abide by all COSTAATT payment terms and conditions as outlined in this document and the College's Academic Calendar.</p>
      
      <p>I acknowledge that:</p>
      <ol>
        <li>I am personally and fully responsible for the payment of all tuition, college fees, and any other applicable charges associated with my enrolment at COSTAATT, regardless of my funding status or eligibility for GATE or any other sponsorship.</li>
        <li>I understand that GATE and/or other sponsors may not cover certain fees or courses (including repeated, withdrawn, or COMPASS courses, as applicable), and that I remain solely responsible for settling any outstanding balances by the published payment deadlines.</li>
        <li>I accept that failure to meet payment deadlines may result in the placement of a financial hold on my account, which may restrict my access to classes, registration, grades, transcripts, or other College services.</li>
        <li>I understand that College fees are non-refundable and non-transferable, except where otherwise provided in the College's refund policy and within the specified deadlines.</li>
        <li>I agree to monitor my student account regularly, to ensure all fees are paid promptly and in full, and to maintain up-to-date records of all payments made to COSTAATT.</li>
        <li>I accept that all financial obligations must be met before I can graduate or access any official College documentation.</li>
      </ol>
    </div>

    <!-- Student Information Form -->
    <div class="student-info-form" id="studentInfoForm">
      <h4 style="text-align: center; margin-bottom: 20px;">üéì Student Information</h4>
      <div class="form-group">
        <label for="studentName">Full Name (as registered):</label>
        <input type="text" id="studentName" placeholder="Enter your full name" required>
      </div>
      <div class="form-group">
        <label for="studentId">COSTAATT Student ID Number:</label>
        <input type="text" id="studentId" placeholder="Enter your 8-digit student ID" pattern="[0-9]{8}" required>
      </div>
    </div>

    <div class="agreement-footer">
      <p style="margin-bottom: 20px; font-weight: bold;">By clicking "I Agree", you acknowledge that you have read, understood, and accept all the terms and conditions outlined above.</p>
      <button class="agree-btn" onclick="acceptAgreement()">
        ‚úÖ I Agree to the Terms & Conditions
      </button>
    </div>
  </div>
</div>

    <div class="calculator-card">
      <h3>Tuition Calculator (Late Fee Applies from 1st October, 2025)</h3>
      
      <div class="controls">
        <button class="btn-primary" id="addRowBtn">
          <span>‚ûï</span> Add Row
        </button>
        <button class="btn-secondary" id="resetTableBtn">
          <span>üîÑ</span> Reset Table
        </button>
      </div>

      <table id="tuitionTable">
        <thead>
          <tr>
            <th>Student Type</th>
            <th>Credits</th>
            <th>Course Description</th>
            <th>Course Type</th>
            <th>Tuition Fee</th>
            <th>GATE</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot>
          <tr>
            <td colspan="6"><strong>Tuition Grand Total</strong></td>
            <td><span id="tuitionGrandTotal" class="total-display">$0.00</span></td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="calculator-card">
      <h3>College Fees Calculator</h3>
      
      <div class="fee-calculator">
        <div class="fee-item">
          <label for="registrationFee">Registration Fee:</label>
          <select id="registrationFee">
            <option value="0">$0</option>
            <option value="280">$280</option>
            <option value="410">$410</option>
          </select>
        </div>
        
        <div class="fee-item">
          <label for="lateFee">Late Fee:</label>
          <select id="lateFee">
            <option value="0">$0</option>
            <option value="50">$50</option>
          </select>
        </div>
      </div>
      
      <div class="controls">
        <button class="btn-accent" onclick="resetCollegeFees()">
          <span>üîÑ</span> Reset College Fees
        </button>
      </div>
    </div>

    <div class="calculator-card">
      <h3>Other Fees</h3>
      
      <div class="fee-calculator">
        <div class="fee-item">
          <label for="otherFees">Other Fees:</label>
          <div class="fee-input">
            <input type="number" id="otherFees" min="0" value="0">
          </div>
        </div>
      </div>
      
      <div class="controls">
        <button class="btn-accent" onclick="resetOtherFees()">
          <span>üîÑ</span> Reset Other Fees
        </button>
      </div>
    </div>

    <div class="calculator-card">
      <div class="totals-section">
        <div>
          <span>Tuition Fees Total:</span>
          <span id="displayTuitionTotal" class="total-display">$0.00</span>
        </div>
        <div>
          <span>College Fees Total:</span>
          <span id="displayCollegeFeesTotal" class="total-display">$0.00</span>
        </div>
        <div>
          <span>Other Fees Total:</span>
          <span id="displayOtherFeesTotal" class="total-display">$0.00</span>
        </div>
        <div class="grand-total">
          <span>Grand Total:</span>
          <span id="grandTotal" class="total-display">$0.00</span>
        </div>
      </div>
    </div>

<div class="disclaimer">
  <h3>Legal Disclaimer</h3>
  <p>The calculations generated by this tool are <strong>estimates only</strong> and are based on the fee information you, the student, have entered from your Account Summary/Account Transactions.</p>
  <p>This Student Fee Calculator is provided<strong> for guidance purposes </strong>only and is intended to help you estimate the self-funded portion of your next payment.</strong>The calculated amounts are estimates and may not reflect your final balance.</p> 
  
  <p>Additional Information:</p>
  <ol>
    <li>A late fee will apply if payment is made after the College's official fee deadline (see the Academic Calendar).</li>
    <li>All amounts are quoted in Trinidad and Tobago Dollars (TTD) unless otherwise stated.</li>
    <li>GATE funding: Confirmed rates are determined by the Ministry of Education Funding and Grant Division and are subject to their review and approval.</li>
    <li>Final tuition and fees must <strong>be confirmed with the College's Bursar Department.</strong></li>
  </ol>
  
  <p style="font-weight:bold; border-top:1px solid #ccc; padding-top:10px;">
  This tool does not constitute professional financial advice under the Financial Institutions Act, Chap. 79:09 of Trinidad and Tobago.
  </p>
    </div>
  </div>

  <script>

// Global variables to store agreement data
let agreementData = {
    accepted: false,
    studentName: '',
    studentId: '',
    agreementDate: '',
    agreementTime: ''
};

// Show payment notice automatically when page loads
window.addEventListener('load', function() {
    setTimeout(() => {
        showPaymentNotice();
    }, 1000);
});

function showPaymentNotice() {
    document.getElementById('noticePopup').classList.add('show');
    document.getElementById('noticeOverlay').classList.add('show');
}

function closePaymentNotice() {
    document.getElementById('noticePopup').classList.remove('show');
    document.getElementById('noticeOverlay').classList.remove('show');
}

function acceptAgreement() {
    const studentName = document.getElementById('studentName').value.trim();
    const studentId = document.getElementById('studentId').value.trim();

    // Validate inputs
    if (!studentName) {
        alert('Please enter your full name.');
        document.getElementById('studentName').focus();
        return;
    }

    if (!studentId || !/^\d{8}$/.test(studentId)) {
        alert('Please enter a valid 8-digit COSTAATT Student ID.');
        document.getElementById('studentId').focus();
        return;
    }

    // Store agreement data
    const now = new Date();
    agreementData = {
        accepted: true,
        studentName: studentName,
        studentId: studentId,
        agreementDate: now.toLocaleDateString('en-TT'),
        agreementTime: now.toLocaleTimeString('en-TT')
    };

    // Update UI
    document.getElementById('agreementDetails').textContent = 
        `By: ${studentName} | ID: ${studentId} | Date: ${agreementData.agreementDate} at ${agreementData.agreementTime}`;
    
    document.getElementById('displayStudentName').textContent = studentName;
    document.getElementById('displayStudentId').textContent = `ID: ${studentId}`;

    // Show status and info displays
    document.getElementById('agreementStatus').style.display = 'block';
    document.getElementById('studentInfoDisplay').style.display = 'block';
    document.getElementById('downloadSection').style.display = 'block';

    // Close the modal
    closePaymentNotice();

    // Show success message
    showTemporaryMessage('‚úÖ Agreement accepted successfully! You can now use the fee calculator.', 'success');
}

function downloadFeeReport() {
    if (!agreementData.accepted) {
        alert('Please accept the agreement first.');
        return;
    }

    // Get current fee calculations
    const tuitionTotal = document.getElementById('displayTuitionTotal').textContent;
    const collegeFeesTotal = document.getElementById('displayCollegeFeesTotal').textContent;
    const otherFeesTotal = document.getElementById('displayOtherFeesTotal').textContent;
    const grandTotal = document.getElementById('grandTotal').textContent;

    // Create report content
    const reportContent = `
COSTAATT - STUDENT FEE CALCULATION REPORT
===========================================

STUDENT INFORMATION:
-------------------
Name: ${agreementData.studentName}
Student ID: ${agreementData.studentId}
Agreement Date: ${agreementData.agreementDate}
Agreement Time: ${agreementData.agreementTime}

FEE BREAKDOWN:
--------------
Tuition Fees: ${tuitionTotal}
College Fees: ${collegeFeesTotal}
Other Fees: ${otherFeesTotal}
---------------------------------
GRAND TOTAL: ${grandTotal}

AGREEMENT CONFIRMATION:
-----------------------
I, ${agreementData.studentName} (ID: ${agreementData.studentId}), hereby confirm that:

1. I have read, understood, and agree to abide by all COSTAATT payment terms and conditions
2. I accept full financial responsibility for all tuition and fees
3. I understand that GATE funding may not cover all courses
4. I acknowledge the payment deadlines and consequences of late payment
5. I agree to monitor my student account regularly

This agreement was accepted on ${agreementData.agreementDate} at ${agreementData.agreementTime}.

CALCULATOR DISCLAIMER:
----------------------
This report is generated for estimation purposes only. Final amounts must be verified with the Bursar's Office. All figures are in Trinidad and Tobago Dollars (TTD).

Generated by COSTAATT Fee Calculator on ${new Date().toLocaleString('en-TT')}
    `;

    // Create and download file
    const blob = new Blob([reportContent], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `COSTAATT_Fee_Report_${agreementData.studentId}_${new Date().getTime()}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);

    // Show download confirmation
    showTemporaryMessage('üì• Fee report downloaded successfully!', 'success');
}
// PDF Generation Functions
function generatePDFReport() {
    if (!agreementData.accepted) {
        alert('Please accept the agreement first.');
        return;
    }

    // Create PDF instance
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Set document properties
    doc.setProperties({
        title: `COSTAATT Fee Report - ${agreementData.studentName}`,
        subject: 'Student Fee Calculation and Agreement',
        author: 'COSTAATT Bursar Department',
        keywords: 'fees, tuition, agreement, COSTAATT',
        creator: 'COSTAATT Fee Calculator'
    });

    // Add content to PDF
    addPDFContent(doc);
    
    // Generate filename
    const filename = `COSTAATT_Fee_Report_${agreementData.studentId}_${new Date().getTime()}.pdf`;
    
    // Save PDF
    doc.save(filename);
    
    // Show download confirmation
    showTemporaryMessage('üì• PDF report downloaded successfully!', 'success');
}

function previewPDF() {
    const previewContent = generatePDFPreviewContent();
    document.getElementById('pdfPreviewContent').innerHTML = previewContent;
    document.getElementById('pdfPreview').style.display = 'block';
}

function generatePDFPreviewContent() {
    const tuitionTotal = document.getElementById('displayTuitionTotal').textContent;
    const collegeFeesTotal = document.getElementById('displayCollegeFeesTotal').textContent;
    const otherFeesTotal = document.getElementById('displayOtherFeesTotal').textContent;
    const grandTotal = document.getElementById('grandTotal').textContent;

    // Get course details
    let courseDetails = '';
    for (let i = 0; i < currentRowCount; i++) {
        const row = document.getElementById('tableBody').rows[i];
        if (row) {
            const studentType = row.cells[0].querySelector('select').value;
            const credits = row.cells[1].querySelector('select').value;
            const courseDesc = document.getElementById(`courseDesc-${i}`).textContent;
            const courseType = row.cells[3].querySelector('select').value;
            const gateCoverage = row.cells[5].querySelector('select').value;
            const courseTotal = document.getElementById(`total-${i}`).textContent;
            
            courseDetails += `
                <div style="margin: 8px 0; padding: 8px; background: #f5f5f5; border-radius: 4px;">
                    <strong>${courseDesc}</strong> | ${credits} Credit(s) | ${courseType}<br>
                    Student Type: ${studentType} | GATE: ${gateCoverage} | Total: ${courseTotal}
                </div>
            `;
        }
    }

    return `
        <div class="pdf-header">
            <h1 style="color: #6a0dad; margin: 0;">COSTAATT</h1>
            <h2 style="margin: 5px 0; color: #333;">Student Fee Calculation Report</h2>
            <p style="margin: 0; color: #666;">College of Science, Technology and Applied Arts of Trinidad and Tobago</p>
        </div>

        <div class="pdf-section">
            <h3 style="color: #6a0dad; border-bottom: 2px solid #6a0dad; padding-bottom: 5px;">Student Information</h3>
            <p><strong>Name:</strong> ${agreementData.studentName}</p>
            <p><strong>Student ID:</strong> ${agreementData.studentId}</p>
            <p><strong>Agreement Date:</strong> ${agreementData.agreementDate} at ${agreementData.agreementTime}</p>
            <p><strong>Report Generated:</strong> ${new Date().toLocaleString('en-TT')}</p>
        </div>

        <div class="pdf-section">
            <h3 style="color: #6a0dad; border-bottom: 2px solid #6a0dad; padding-bottom: 5px;">Course Details</h3>
            ${courseDetails || '<p>No courses added to calculation.</p>'}
        </div>

        <div class="pdf-section pdf-totals">
            <h3 style="color: #2e7d32; border-bottom: 2px solid #2e7d32; padding-bottom: 5px;">Fee Summary</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #ccc;"><strong>Tuition Fees:</strong></td>
                    <td style="padding: 8px; border-bottom: 1px solid #ccc; text-align: right;">${tuitionTotal}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #ccc;"><strong>College Fees:</strong></td>
                    <td style="padding: 8px; border-bottom: 1px solid #ccc; text-align: right;">${collegeFeesTotal}</td>
                </tr>
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #ccc;"><strong>Other Fees:</strong></td>
                    <td style="padding: 8px; border-bottom: 1px solid #ccc; text-align: right;">${otherFeesTotal}</td>
                </tr>
                <tr style="font-size: 1.2em;">
                    <td style="padding: 12px 8px; border-top: 2px solid #2e7d32;"><strong>GRAND TOTAL:</strong></td>
                    <td style="padding: 12px 8px; border-top: 2px solid #2e7d32; text-align: right;"><strong>${grandTotal}</strong></td>
                </tr>
            </table>
        </div>

        <div class="pdf-section pdf-agreement">
            <h3 style="color: #e65100; border-bottom: 2px solid #e65100; padding-bottom: 5px;">Financial Responsibility Agreement</h3>
            <p><strong>I, ${agreementData.studentName} (ID: ${agreementData.studentId}), hereby confirm that:</strong></p>
            <ol style="padding-left: 20px;">
                <li>I have read, understood, and agree to abide by all COSTAATT payment terms and conditions</li>
                <li>I accept full financial responsibility for all tuition and fees associated with my enrollment</li>
                <li>I understand that GATE funding may not cover withdrawn, repeated, or COMPASS courses</li>
                <li>I acknowledge the payment deadlines and consequences of late payment</li>
                <li>I agree to monitor my student account regularly throughout my time at the College</li>
                <li>I understand that all financial obligations must be met before graduation</li>
            </ol>
            <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 5px; border: 1px solid #ff9800;">
                <p style="margin: 0; text-align: center;">
                    <strong>Digital Signature</strong><br>
                    ${agreementData.studentName}<br>
                    <em>Accepted on ${agreementData.agreementDate} at ${agreementData.agreementTime}</em>
                </p>
            </div>
        </div>

        <div class="pdf-section">
            <h3 style="color: #6a0dad; border-bottom: 2px solid #6a0dad; padding-bottom: 5px;">Payment Information</h3>
            <p><strong>Payment Methods Accepted:</strong></p>
            <ul>
                <li>Personal Online Banking (FCB and RBL)</li>
                <li>Inter-Bank Transfer (First Citizens Bank - Account: 1210236)</li>
                <li>In-Person (LINX and Credit Card only - No cash)</li>
                <li>COSTAATT ePay Service</li>
            </ul>
            <p><strong>Payment Submission:</strong> Email proof of payment to <strong>payments@costaatt.edu.tt</strong></p>
        </div>

        <div class="pdf-footer">
            <p><strong>Disclaimer:</strong> This report is generated for estimation purposes only. Final amounts must be verified with the Bursar's Office. All figures are in Trinidad and Tobago Dollars (TTD).</p>
            <p>Generated by COSTAATT Fee Calculator | ${new Date().toLocaleString('en-TT')}</p>
        </div>
    `;
}

function addPDFContent(doc) {
    const pageWidth = doc.internal.pageSize.getWidth();
    const margin = 20;
    let yPosition = 20;

    // Add header
    doc.setFontSize(20);
    doc.setTextColor(106, 13, 173);
    doc.text('COSTAATT', pageWidth / 2, yPosition, { align: 'center' });
    
    doc.setFontSize(16);
    doc.setTextColor(0, 0, 0);
    yPosition += 10;
    doc.text('Student Fee Calculation Report', pageWidth / 2, yPosition, { align: 'center' });
    
    doc.setFontSize(10);
    yPosition += 6;
    doc.text('College of Science, Technology and Applied Arts of Trinidad and Tobago', pageWidth / 2, yPosition, { align: 'center' });
    
    yPosition += 20;

    // Student Information Section
    doc.setFontSize(14);
    doc.setTextColor(106, 13, 173);
    doc.text('STUDENT INFORMATION', margin, yPosition);
    yPosition += 10;
    
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    doc.text(`Name: ${agreementData.studentName}`, margin, yPosition);
    yPosition += 6;
    doc.text(`Student ID: ${agreementData.studentId}`, margin, yPosition);
    yPosition += 6;
    doc.text(`Agreement Date: ${agreementData.agreementDate} at ${agreementData.agreementTime}`, margin, yPosition);
    yPosition += 6;
    doc.text(`Report Generated: ${new Date().toLocaleString('en-TT')}`, margin, yPosition);
    yPosition += 15;

    // Fee Summary Section
    const tuitionTotal = document.getElementById('displayTuitionTotal').textContent;
    const collegeFeesTotal = document.getElementById('displayCollegeFeesTotal').textContent;
    const otherFeesTotal = document.getElementById('displayOtherFeesTotal').textContent;
    const grandTotal = document.getElementById('grandTotal').textContent;

    doc.setFontSize(14);
    doc.setTextColor(46, 125, 50);
    doc.text('FEE SUMMARY', margin, yPosition);
    yPosition += 10;

    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    doc.text(`Tuition Fees: ${tuitionTotal}`, margin, yPosition);
    yPosition += 6;
    doc.text(`College Fees: ${collegeFeesTotal}`, margin, yPosition);
    yPosition += 6;
    doc.text(`Other Fees: ${otherFeesTotal}`, margin, yPosition);
    yPosition += 8;
    
    doc.setFontSize(12);
    doc.setFont(undefined, 'bold');
    doc.text(`GRAND TOTAL: ${grandTotal}`, margin, yPosition);
    doc.setFont(undefined, 'normal');
    yPosition += 20;

    // Agreement Section
    doc.setFontSize(14);
    doc.setTextColor(230, 81, 0);
    doc.text('FINANCIAL RESPONSIBILITY AGREEMENT', margin, yPosition);
    yPosition += 10;

    doc.setFontSize(9);
    doc.setTextColor(0, 0, 0);
    const agreementText = [
        `I, ${agreementData.studentName} (ID: ${agreementData.studentId}), hereby confirm that:`,
        '1. I have read, understood, and agree to abide by all COSTAATT payment terms',
        '2. I accept full financial responsibility for all tuition and fees',
        '3. I understand GATE funding limitations for certain courses',
        '4. I acknowledge payment deadlines and consequences',
        '5. I agree to monitor my student account regularly',
        '6. I understand financial obligations must be met before graduation'
    ];

    agreementText.forEach(line => {
        if (yPosition > 270) {
            doc.addPage();
            yPosition = 20;
        }
        doc.text(line, margin, yPosition);
        yPosition += 5;
    });

    yPosition += 10;
    doc.text(`Digital Signature: ${agreementData.studentName}`, margin, yPosition);
    yPosition += 5;
    doc.text(`Accepted on: ${agreementData.agreementDate} at ${agreementData.agreementTime}`, margin, yPosition);
    yPosition += 15;

    // Disclaimer
    doc.setFontSize(8);
    doc.setTextColor(100, 100, 100);
    const disclaimer = 'This report is for estimation purposes only. Final amounts must be verified with the Bursar\'s Office. All figures in TTD. Generated by COSTAATT Fee Calculator.';
    
    const splitDisclaimer = doc.splitTextToSize(disclaimer, pageWidth - 2 * margin);
    doc.text(splitDisclaimer, pageWidth / 2, 280, { align: 'center' });
}

// Replace the existing downloadFeeReport function
function downloadFeeReport() {
    generatePDFReport();
}
function showTemporaryMessage(message, type) {
    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;
    messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#4CAF50' : '#ff9800'};
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        z-index: 1001;
        font-weight: bold;
        transition: all 0.3s ease;
    `;
    
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateX(100px)';
        setTimeout(() => {
            document.body.removeChild(messageDiv);
        }, 300);
    }, 3000);
}

// Close popup when pressing Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closePaymentNotice();
    }
});

// Update download section visibility when totals change
function updateGrandTotal() {
    const tuitionTotal = parseFloat(document.getElementById('displayTuitionTotal').textContent.replace('$', '')) || 0;
    const collegeFeesTotal = parseFloat(document.getElementById('displayCollegeFeesTotal').textContent.replace('$', '')) || 0;
    const otherFeesTotal = parseFloat(document.getElementById('displayOtherFeesTotal').textContent.replace('$', '')) || 0;
    const grandTotal = tuitionTotal + collegeFeesTotal + otherFeesTotal;
    document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
    
    // Show download section if agreement is accepted and there are fees
    if (agreementData.accepted && grandTotal > 0) {
        document.getElementById('downloadSection').style.display = 'block';
    }
}
     
    const studentTypes = ['Local National', 'Caricom National', 'International National'];
    const courseOptions = ['Compass Course', 'Undergraduate Course', 'Repeated Course'];
    const gradCourseOptions = ['Compass Course', 'Graduate Course', 'Repeated Course'];
      const gateOptions = ['0%', '25%', '50%', '75%', '100%'];
    const creditOptions = [1, 2, 3, 4, 5];
    
    // Tuition fees for undergraduate, graduate and short courses
    let tuitionFees = {
      'undergrad': {
        'Local National': 300,
        'Caricom National': 450,
        'International National': 750
      },
      'grad': {
        'Local National': 500,
        'Caricom National': 600,
        'International National': 750
      }
    };
    
    const maxRows = 8;
    let currentRowCount = 0;
    let lastSelectedType = 'Local National';
    let lastSelectedGate = '0%';
    let currentCourseType = 'undergrad'; // 'undergrad', 'grad', or 'short'

    function switchCourseType(type) {
      currentCourseType = type;
      document.getElementById('undergradTab').classList.remove('active');
      document.getElementById('gradTab').classList.remove('active');
          document.getElementById(type + 'Tab').classList.add('active');
      
      // Update all rows with new tuition fees
      for (let i = 0; i < currentRowCount; i++) {
        updateRow(i);
      }
      
      // Update totals
      updateTotalsSection();
    }

    function createRow(index) {
      if (currentRowCount >= maxRows) return;

      const row = document.createElement('tr');
      row.dataset.index = index;

      // Student Type
      const studentCell = document.createElement('td');
      const studentSelect = document.createElement('select');
      studentTypes.forEach(type => {
        const option = document.createElement('option');
        option.value = type;
        option.text = type;
        if (type === lastSelectedType) option.selected = true;
        studentSelect.appendChild(option);
      });
      studentSelect.addEventListener('change', () => {
        lastSelectedType = studentSelect.value;
        updateRow(index);
      });
      studentCell.appendChild(studentSelect);
      row.appendChild(studentCell);

      // Credits Selector
      const creditCell = document.createElement('td');
      const creditSelect = document.createElement('select');
      creditOptions.forEach(credit => {
        const option = document.createElement('option');
        option.value = credit;
        option.text = credit;
        creditSelect.appendChild(option);
      });
      creditSelect.addEventListener('change', () => {
        updateRow(index);
      });
      creditCell.appendChild(creditSelect);
      row.appendChild(creditCell);

      // Course Description (based on credits)
      const courseDescCell = document.createElement('td');
      const courseDescSpan = document.createElement('span');
      courseDescSpan.id = `courseDesc-${index}`;
      courseDescSpan.textContent = 'Select credits';
      courseDescCell.appendChild(courseDescSpan);
      row.appendChild(courseDescCell);

      // Course Type
      const courseCell = document.createElement('td');
      const courseSelect = document.createElement('select');
      const allowedCourseTypes = currentCourseType === 'undergrad' ? 
        ['Compass Course', 'Undergraduate Course', 'Repeated Course'] : 
        ['Compass Course', 'Graduate Course', 'Repeated Course'];
      
      allowedCourseTypes.forEach(course => {
        const option = document.createElement('option');
        option.value = course;
        option.text = course;
        courseSelect.appendChild(option);
      });
      courseSelect.addEventListener('change', () => {
        updateRow(index);
      });
      courseCell.appendChild(courseSelect);
      row.appendChild(courseCell);

      // Tuition Fee
      const feeCell = document.createElement('td');
      const feeInput = document.createElement('input');
      feeInput.type = 'number';
      feeInput.readOnly = true;
      feeInput.style.backgroundColor = '#f5f5f5';
      feeInput.style.border = '1px solid #ddd';
      feeCell.appendChild(feeInput);
      row.appendChild(feeCell);

      // GATE
      const gateCell = document.createElement('td');
      const gateSelect = document.createElement('select');
      gateOptions.forEach(optionVal => {
        const option = document.createElement('option');
        option.value = optionVal;
        option.text = optionVal;
        if (optionVal === lastSelectedGate) option.selected = true;
        gateSelect.appendChild(option);
      });
      gateSelect.addEventListener('change', () => {
        lastSelectedGate = gateSelect.value;
        updateRow(index);
      });
      gateCell.appendChild(gateSelect);
      row.appendChild(gateCell);

      // Total
      const totalCell = document.createElement('td');
      const totalSpan = document.createElement('span');
      totalSpan.id = `total-${index}`;
      totalSpan.textContent = '$0.00';
      totalSpan.style.fontWeight = 'bold';
      totalCell.appendChild(totalSpan);
      row.appendChild(totalCell);

      // Clear Button
      const actionCell = document.createElement('td');
      const clearBtn = document.createElement('button');
      clearBtn.textContent = '‚ùå';
      clearBtn.style.background = 'none';
      clearBtn.style.border = 'none';
      clearBtn.style.cursor = 'pointer';
      clearBtn.style.fontSize = '18px';
      clearBtn.addEventListener('click', () => clearRow(index));
      actionCell.appendChild(clearBtn);
      row.appendChild(actionCell);

      document.getElementById('tableBody').appendChild(row);
      currentRowCount++;
      updateRow(index);

      if (currentRowCount >= maxRows) {
        document.getElementById('addRowBtn').disabled = true;
      }
    }

    function updateRow(index) {
      const row = document.getElementById('tableBody').rows[index];
      if (!row) return;

      const studentType = row.cells[0].querySelector('select').value;
      const credits = parseInt(row.cells[1].querySelector('select').value) || 0;
      const courseType = row.cells[3].querySelector('select').value;
      const feeInput = row.cells[4].querySelector('input');
      const gateSelect = row.cells[5].querySelector('select');

      // Update course description based on credits
      const courseDescSpan = document.getElementById(`courseDesc-${index}`);
      if (credits === 1) {
        courseDescSpan.textContent = 'One Credit Course';
      } else if (credits === 2) {
        courseDescSpan.textContent = 'Two Credit Course';
      } else if (credits === 3) {
        courseDescSpan.textContent = 'Three Credit Course';
      } else if (credits === 4) {
        courseDescSpan.textContent = 'Four Credit Course';
      } else if (credits === 5) {
        courseDescSpan.textContent = 'Five Credit Course';
      } else {
        courseDescSpan.textContent = 'Select credits';
      }

      // Get tuition fee based on course type (undergrad/grad) and student type
      const tuitionFee = tuitionFees[currentCourseType][studentType];
      feeInput.value = tuitionFee;

      // Disable GATE if not Local National OR if not Undergraduate Course
      const isCompassOrRepeated = courseType === 'Compass Course' || courseType === 'Repeated Course';
      const isUndergradCourse = courseType === 'Undergraduate Course';
      const isLocalNational = studentType === 'Local National';
      
      gateSelect.disabled = !isLocalNational || !isUndergradCourse || isCompassOrRepeated;
      
      // If not eligible for GATE, force to 0%
      if (!isLocalNational || !isUndergradCourse || isCompassOrRepeated) {
        gateSelect.value = '0%';
      }

      const gateVal = gateSelect.value;
      const gateMap = {
        '0%': 1,
        '25%': 0.75,
        '50%': 0.5,
        '75%': 0.25,
        '100%': 0
      };
      const gateMultiplier = (isLocalNational && isUndergradCourse && !isCompassOrRepeated) ? gateMap[gateVal] : 1;

      const total = credits * tuitionFee * gateMultiplier;
      document.getElementById(`total-${index}`).textContent = `$${total.toFixed(2)}`;

      computeTuitionGrandTotal();
      updateTotalsSection();
    }

    function computeTuitionGrandTotal() {
      let total = 0;
      for (let i = 0; i < currentRowCount; i++) {
        const totalText = document.getElementById(`total-${i}`)?.textContent || '$0';
        total += parseFloat(totalText.replace('$', '')) || 0;
      }
      document.getElementById('tuitionGrandTotal').textContent = `$${total.toFixed(2)}`;
      document.getElementById('displayTuitionTotal').textContent = `$${total.toFixed(2)}`;
      updateGrandTotal();
    }

    function updateCollegeFeesCalculator() {
      const registrationFee = parseFloat(document.getElementById('registrationFee').value) || 0;
      const lateFee = parseFloat(document.getElementById('lateFee').value) || 0;
      
      const totalCollegeFees = registrationFee + lateFee;
      
      document.getElementById('displayCollegeFeesTotal').textContent = `$${totalCollegeFees.toFixed(2)}`;
      updateGrandTotal();
    }

    function updateOtherFeesCalculator() {
      const otherFees = parseFloat(document.getElementById('otherFees').value) || 0;
      document.getElementById('displayOtherFeesTotal').textContent = `$${otherFees.toFixed(2)}`;
      updateGrandTotal();
    }

    function updateTotalsSection() {
      updateCollegeFeesCalculator();
      updateOtherFeesCalculator();
      updateGrandTotal();
    }

    function updateGrandTotal() {
      const tuitionTotal = parseFloat(document.getElementById('displayTuitionTotal').textContent.replace('$', '')) || 0;
      const collegeFeesTotal = parseFloat(document.getElementById('displayCollegeFeesTotal').textContent.replace('$', '')) || 0;
      const otherFeesTotal = parseFloat(document.getElementById('displayOtherFeesTotal').textContent.replace('$', '')) || 0;
      const grandTotal = tuitionTotal + collegeFeesTotal + otherFeesTotal;
      document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
    }

    function resetCollegeFees() {
      document.getElementById('registrationFee').value = '0';
      document.getElementById('lateFee').value = '0';
      updateCollegeFeesCalculator();
    }

    function resetOtherFees() {
      document.getElementById('otherFees').value = '0';
      updateOtherFeesCalculator();
    }

    function clearRow(index) {
      const row = document.getElementById('tableBody').rows[index];
      if (!row) return;

      row.cells[1].querySelector('select').value = '1';
      document.getElementById(`courseDesc-${index}`).textContent = 'One Credit Course';
      row.cells[3].querySelector('select').value = courseOptions[0];
      row.cells[4].querySelector('input').value = tuitionFees[currentCourseType][lastSelectedType];
      row.cells[5].querySelector('select').value = lastSelectedGate;
      document.getElementById(`total-${index}`).textContent = '$0.00';

      updateRow(index);
    }

    function resetTable() {
      document.getElementById('tableBody').innerHTML = '';
      document.getElementById('tuitionGrandTotal').textContent = '$0.00';
      document.getElementById('displayTuitionTotal').textContent = '$0.00';
      currentRowCount = 0;
      document.getElementById('addRowBtn').disabled = false;
      createRow(0);
      updateTotalsSection();
    }

    function toggleInstructions() {
      const instructions = document.getElementById('instructions');
      const button = event.target.closest('button');
      const isVisible = instructions.classList.contains('show');

      if (isVisible) {
        instructions.classList.remove('show');
        button.innerHTML = '<span>üìù</span> Show Instructions';
      } else {
        instructions.classList.add('show');
        button.innerHTML = '<span>üìù</span> Hide Instructions';
      }
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const themeToggle = document.getElementById('themeToggle');
      if (document.body.classList.contains('dark-mode')) {
        themeToggle.textContent = '‚òÄÔ∏è';
        themeToggle.title = 'Switch to Light Mode';
      } else {
        themeToggle.textContent = 'üåô';
        themeToggle.title = 'Switch to Dark Mode';
      }
    }

    // Initial setup
    document.getElementById('addRowBtn').addEventListener('click', () => {
      if (currentRowCount < maxRows) {
        createRow(currentRowCount);
      }
    });

    document.getElementById('resetTableBtn').addEventListener('click', resetTable);

    // Add event listeners for college fees inputs
    document.getElementById('registrationFee').addEventListener('change', updateCollegeFeesCalculator);
    document.getElementById('lateFee').addEventListener('change', updateCollegeFeesCalculator);
    document.getElementById('otherFees').addEventListener('input', updateOtherFeesCalculator);

    // Dark mode toggle
    document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);

    // Start with one row
    createRow(0);
  </script>
</body>
</html>
